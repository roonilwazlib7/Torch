(function(){var AABB,AjaxLoader,Animation,AnimationManager,ArrayUtility,AssetManager,AtlasFrameAnimation,Audio,AudioPlayer,BindManager,BitmapText,BodyManager,Camera,CanvasGame,CanvasRenderer,Circle,Collision,CollisionDetector,CollisionManager,Color,DebugConsole,DrawParams,ER,EffectComponent,EffectManager,Event,EventDispatcher,EventManager,FunctionUtility,FutureEvent,Game,GamePad,GamePadButton,GamePadManager,GamePadStick,GameThing,GameThingFactory,GridManager,HookManager,JerkFollow,Key,Keys,Layer,Layers,Load,LoadJob,LoadType,Loop,MathUtility,Mouse,ObjectUtility,Orbit,ParticleEmitter,ParticleManager,Point,RandomPool,Rectangle,ScheduledEvent,Shapes,SizeManager,Sound,Sprite,SpriteGroup,SpriteSheetAnimation,State,StateMachine,StateMachineManager,StringUtility,Text,Texture,Timer,Torch,TorchModule,TorchModules,TrailEffect,Trashable,Tween,TweenManager,TweenSetup,Util,Utilities,Vector,Video,Viewport,_measureCanvas,exports,temp,extend=function(t,e){function i(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,slice=[].slice;ER={},ER.ER=function(){function t(t){t&&this.Fatal(),this.nativeError=new Error(this.message)}return t.prototype.message=null,t.prototype.nativeError=null,t.prototype.Fatal=function(){return Torch.FatalError(this.message)},t.prototype.toString=function(){return this.message},t}(),ER.ArgumentError=function(t){function e(t,i,n,o){var r,s,a,h,u;if(this.argument=t,this.valueProvided=i,this.argumentTypes=n,null==o&&(o=!1),this.message="ArgumentError: value '"+this.valueProvided+"("+Util.Type(this.valueProvided)+")' is not a valid argument for "+this.argument,null!=this.argumentTypes){for(this.message+="(",h=this.argumentTypes,r=s=0,a=h.length;s<a;r=++s)u=h[r],0!==r&&(this.message+=","),this.message+=u;this.message+=")"}e.__super__.constructor.call(this,o)}return extend(e,t),e.prototype.message=null,e}(ER.ER),ArrayUtility=function(){function t(t){this.array=t}return t.prototype.Array=function(){return this.array},t.prototype.All=function(t){var e,i,n,o,r;for(o=this.array,r=[],i=0,n=o.length;i<n;i++)e=o[i],r.push(t(e));return r},t.prototype.Find=function(t){var e,i,n,o;for(o=this.array,i=0,n=o.length;i<n;i++)if(e=o[i],t(e))return e},t.prototype.Filter=function(t){var e,i,n,o,r;for(r=[],o=this.array,i=0,n=o.length;i<n;i++)e=o[i],t(e)&&r.push(e);return r},t.prototype.Reject=function(t){var e,i,n,o,r;for(r=[],o=this.array,i=0,n=o.length;i<n;i++)e=o[i],t(e)||r.push(e);return r},t.prototype.Where=function(t){var e;return e=this.Filter(function(e){var i,n;for(i in t)if(n=t[i],e[i]!==n)return!1;return!0})},t.prototype.Every=function(t){var e,i,n,o;for(o=this.array,i=0,n=o.length;i<n;i++)if(e=o[i],!t(e))return!1;return!0},t.prototype.Some=function(t){var e,i,n,o;for(o=this.array,i=0,n=o.length;i<n;i++)if(e=o[i],t(e))return!0;return!1},t.prototype.Contains=function(t,e){var i;return null==e&&(e=0),i=this.array.indexOf(t),i!==-1&&i>=e},t.prototype.Pluck=function(t){var e,i,n,o,r;for(o=[],r=this.array,i=0,n=r.length;i<n;i++)e=r[i],o.push(e[t]);return o},t.prototype.Max=function(t){var e,i,n,o,r,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,o=0,r=s.length;o<r;o++)n=s[o],e=t(n),e>i&&(i=n);return i},t.prototype.Min=function(t){var e,i,n,o,r,s;for(i=0,null==t&&(t=function(t){return t}),s=this.array,o=0,r=s.length;o<r;o++)n=s[o],e=t(n),e<i&&(i=e);return i},t.prototype.SortBy=function(t){},t.prototype.GroupBy=function(t){var e,i,n,o,r,s;for(null==t&&(t=function(t){return t.toString().length}),i={},s=this.array,o=0,r=s.length;o<r;o++)n=s[o],e=t(n),null==i[e]?i[e]=[n]:i[e].push(n);return i},t.prototype.CountBy=function(t){var e,i,n;e=this.GroupBy(t);for(i in e)n=e[i],e[i]=n.length;return e},t.prototype.Shuffle=function(){var t,e,i;for(t=this.array.length,i=t,e=t;0!==t;)e=Math.floor(Math.random()*t),t-=1,i=this.array[t],this.array[t]=this.array[e],this.array[e]=i;return this.array},t.prototype.Sample=function(t){var e,i;for(null==t&&(t=1),i=[],e=[];t>0;)e.push(t--);return e},t.prototype.Partition=function(t){return[this.Filter(t),this.Reject(t)]},t.prototype.First=function(t){var e;if(null==t&&(t=1),1===t)return this.array[0];for(e=[];t<=this.array.length;)e.push(this.array[t-1]),t++;return e},t.prototype.Last=function(t){var e;if(null==t&&(t=1),1===t)return this.array[this.array.length-1];for(e=[];t<=this.array.length;)e.push(this.array[this.array.length-(t-1)]),t++;return e},t.prototype.Flatten=function(){},t.prototype.Without=function(){var t,e,i,n,o,r;for(r=1<=arguments.length?slice.call(arguments,0):[],t=[],o=this.array,i=0,n=o.length;i<n;i++)e=o[i],r.indexOf(e)===-1&&t.push(e);return t},t.prototype.Union=function(){var t,e,i,n,o,r,s,a,h;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),n=[],r=0,s=i.length;r<s;r++)for(t=i[r],h=0,a=t.length;h<a;h++)o=t[h],n.indexOf(o)===-1&&n.push(o);return n},t.prototype.Intersection=function(){var t,e,i,n,o,r,s,a,h,u,p,l;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[this.array].concat(slice.call(e)),n=[],o={},s=0,h=i.length;s<h;s++)for(t=i[s],p=0,u=t.length;p<u;p++)r=t[p],null==o[r]?o[r]=1:o[r]+=1;for(a in o)l=o[a],l>=e.length&&n.push(a);return n},t.prototype.Uniq=function(){},t.prototype.Zip=function(){var t,e,i,n,o,r,s,a,h,u,p;for(e=1<=arguments.length?slice.call(arguments,0):[],i=[],p=this.array,n=r=0,s=p.length;r<s;n=++r){for(o=p[n],u=[o],h=0,a=e.length;h<a;h++)t=e[h],u.push(t[n]);i.push(u)}return i},t.prototype.UnZip=function(){var t;t=1<=arguments.length?slice.call(arguments,0):[]},t}(),StringUtility=function(){function t(t){this.str=t}return t.prototype.String=function(){return this.str},t.prototype.Chunk=function(t){return this.str=this.str.match(new RegExp(".{1,"+t+"}","g")),this.str},t.prototype.Capitalize=function(){return this.str[0]=this.str[0].toUpperCase(),this.str},t}(),FunctionUtility=function(){function t(t){this.func=t}return t.prototype.Defer=function(){var t,e;return t=1<=arguments.length?slice.call(arguments,0):[],e=function(e){return function(){return e.func.apply(e,t)}}(this),setTimeout(e,0)},t.prototype.Once=function(){var t,e;return e=this.func,t=function(){var t;if(t=1<=arguments.length?slice.call(arguments,0):[],!this.called)return e.apply(null,t),this.called=!0}},t.prototype.After=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesBeforeExecuted+=1,!(this.calledCount<t))return i.apply(null,e),this.called=!0},e.timesBeforeExecuted=0,e},t.prototype.Before=function(t){var e,i;return i=this.func,e=function(){var e;if(e=1<=arguments.length?slice.call(arguments,0):[],this.timesExecuted+=1,!(this.calledCount>t))return i.apply(null,e),this.called=!0},e.timesExecuted=0,e},t.prototype.Compose=function(){var t,e,i,n;return e=1<=arguments.length?slice.call(arguments,0):[],t=[this.func].concat(slice.call(e)),i=0,n=function(){var e,n;for(e=void 0,n=[];i<t.length;)e=t[i](e),n.push(i++);return n}},t}(),ObjectUtility=function(){function t(t){this.obj=t}return t.prototype.Keys=function(){var t,e,i,n;e=[],i=this.obj;for(t in i)n=i[t],e.push(t);return e},t.prototype.Values=function(){var t,e,i,n;n=[],e=this.obj;for(t in e)i=e[t],n.push(i);return n},t.prototype.All=function(t){var e,i,n;i=this.obj;for(e in i)n=i[e],this.obj[e]=t(e,n);return this.obj},t.prototype.Invert=function(){var t,e,i,n;e={},i=this.obj;for(t in i)n=i[t],e[n]=t;return e},t.prototype.Functions=function(){var t,e,i,n;t=[],i=this.obj;for(e in i)n=i[e],"function"==typeof n&&t.push(n.name);return t},t.prototype.Extend=function(){var t,e,i,n,o,r;for(o=1<=arguments.length?slice.call(arguments,0):[],t=0,i=o.length;t<i;t++){n=o[t];for(e in n)r=n[e],this.obj[e]=r}return this.obj},t.prototype.Pick=function(){var t,e,i,n,o,r,s;if(o=1<=arguments.length?slice.call(arguments,0):[],n={},"function"==typeof o){r=this.obj;for(e in r)s=r[e],o(e,s,this.obj)&&(n[e]=s)}else for(t=0,i=o.length;t<i;t++)e=o[t],n[e]=this.obj[e];return n},t.prototype.Omit=function(){var t,e,i,n,o,r;if(i=1<=arguments.length?slice.call(arguments,0):[],e={},"function"==typeof i){n=this.obj;for(t in n)r=n[t],i(t,r,this.obj)||(e[t]=r)}else{o=this.obj;for(t in o)r=o[t],i.indexOf(t)===-1&&(e[t]=this.obj[t])}return e},t.prototype.Clone=function(){},t.prototype.Has=function(t){return null!=this.obj[t]},t.prototype.Matches=function(t){var e,i;for(e in t)if(i=t[e],this.obj[e]!==i)return!1;return!0},t.prototype.Empty=function(){return 0===this.Keys().length},t}(),MathUtility=function(){function t(){this.RandomPool=RandomPool}return t.prototype.RandomInRange=function(t,e){return Math.random()*(e-t+1)+t},t.prototype.Sign=function(t){return t>0?1:t<0?-1:0},t}(),RandomPool=function(){function t(){this.choices=[]}return t.prototype.choices=null,t.prototype.AddChoice=function(t,e){var i,n;for(i=e,n=[];i>0;)i--,n.push(this.choices.push(t));return n},t.prototype.Pick=function(){return this.choices=Util.Array(this.choices).Shuffle(),this.choices[0]},t}(),TorchModules=[],TorchModule=function(t,e){var i;return i=t.name,null!=e&&(i=e),TorchModules.push({name:i,mod:t})},Utilities=function(){function t(){this.Math=new MathUtility}return t.prototype.String=function(t){return new StringUtility(t)},t.prototype.Array=function(t){return new ArrayUtility(t)},t.prototype.Function=function(t){return new FunctionUtility(t)},t.prototype.Object=function(t){return new ObjectUtility(t)},t.prototype.Type=function(t){var e,i,n,o,r,s;if(null!=t){if(null!=t.torch_type)return t.torch_type;for(e={},s=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"],i=0,n=s.length;i<n;i++)o=s[i],e["[object "+o+"]"]=o.toLowerCase();return r=Object.prototype.toString.call(t),e[r]||"object"}return null},t.prototype.Enum=function(){var t,e,i,n,o,r;for(r=1<=arguments.length?slice.call(arguments,0):[],n={nameMap:{}},n.GetStringValue=function(t){return this.nameMap[t]},t=e=0,i=r.length;e<i;t=++e)o=r[t],n[o]=t+1,n.nameMap[t+1]=o;return n},t}(),Util=new Utilities,AjaxLoader=function(){function t(t,e){null==e&&(e=window.Torch.AjaxData.Text),this.url=t,this.responseType=this.GetResponseTypeString(e)}return t.prototype.onFinish=function(){},t.prototype.onError=function(){},t.prototype.GetResponseTypeString=function(t){switch(t){case window.Torch.AjaxData.DOMString:return"";case window.Torch.AjaxData.ArrayBuffer:return"arraybuffer";case window.Torch.AjaxData.Blob:return"blob";case window.Torch.AjaxData.Document:return"document";case window.Torch.AjaxData.Json:return"json";case window.Torch.AjaxData.Text:return"text"}},t.prototype.Error=function(t){return this.onError=t},t.prototype.Finish=function(t){return this.onFinish=t},t.prototype.Load=function(){var t;return t=new XMLHttpRequest,t.open("GET",this.url,!0),t.responseType=this.responseType,t.onload=function(e){return function(){return e.onFinish(t.response,e)}}(this),t.send()},t}(),"undefined"!=typeof window&&null!==window&&(window.onerror=function(){var t,e;if(t=1<=arguments.length?slice.call(arguments,0):[],window.Torch.STRICT_ERRORS)return document.body.style.backgroundColor="black",e=t[4],void 0!==e?Torch.FatalError(e):Torch.FatalError("An error has occured")}),Function.prototype.MixIn=Function.prototype.is=function(t){var e,i,n,o;n=this.prototype,e=Object.create(t.prototype);for(i in e)o=e[i],n[i]=o;return this},Function.prototype.property=function(t,e){return Object.defineProperty(this.prototype,t,e)},EventDispatcher=function(){function t(){}return t.dispatchers=[],t.prototype.InitEventDispatch=function(){return this.events={},t.dispatchers.push(this)},t.prototype.On=function(t,e){var i;return this.events[t]||(i=[],i.triggers=0,this.events[t]=i),this.events[t].push(e),this},t.prototype.Emit=function(t,e){var i,n,o,r;if(void 0!==this.events[t])for(r=this.events[t],n=0,o=r.length;n<o;n++)i=r[n],this.events[t].triggers++,i(e);return this},t.prototype.Off=function(t){var e,i,n;if(null==t&&(t=""),""!==t)this.events[t]=void 0;else{i=this.events;for(e in i)n=i[e],this.events[e]=void 0}return this},t}(),Trashable=function(){function t(){}return t.prototype.trash=!1,t.prototype.trashed=!1,t.prototype.Trash=function(){return this.trash=!0},t}(),TorchModule(GameThing=function(){function t(){}return t.MixIn(Trashable),t.prototype.torch_game_thing=!0,t.prototype.torch_uid=null,t.prototype.torch_add_order=null,t.prototype.game=null,t.prototype.drawIndex=0,t.prototype.Update=function(){},t.prototype.Draw=function(){},t.prototype.Id=function(t){return this.game.thingMap[t]=this},t}()),TorchModule(DebugConsole=function(){function DebugConsole(t){var e,i;this.game=t,i='<div id = "torch-console" style = "position: absolute;z-index: 100;top:0;border: 1px solid orange;background-color:black">\n    <p style = "color:white;margin-left:1%;font-family:monospace">Torch Dev Console. Type /HELP for usage</p>\n    <input type="text" id = "torch-console-input" placeholder="Torch Dev Console, type /HELP for usage"/ style = "outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 16px;padding: 3%;width: 100%;" />\n    <div id = "torch-console-output" style = "overflow:auto;outline: none;border: none;font-family: monospace;color: white;background-color: black;font-size: 14px;padding: 1%;width: 98%;height:250px"></div>\n</div>',e=document.createElement("div"),e.innerHTML=i,e.style.display="none",document.body.appendChild(e),this.console=e,this.consoleInput=document.getElementById("torch-console-input"),this.consoleOutput=document.getElementById("torch-console-output"),this.commands={},this.variables={},this.LoadDefaultCommands(),document.addEventListener("keypress",function(t){return function(e){return 47===e.keyCode?t.Toggle(!0):13===e.keyCode?t.ParseCommand():void 0}}(this)),document.addEventListener("keydown",function(t){return function(e){if(27===e.keyCode)return t.Toggle(!1)}}(this))}return DebugConsole.prototype.enabled=!1,DebugConsole.prototype.console=null,DebugConsole.prototype.consoleInput=null,DebugConsole.prototype.consoleOutput=null,DebugConsole.prototype.commands=null,DebugConsole.prototype.variables=null,DebugConsole.prototype.Toggle=function(t){return null==t&&(t=!0),t?(this.console.style.display="block",this.consoleInput.focus(),this.enabled=!0,Util.Array(this.game.things).All(function(t){if(t.Pause)return t.Pause()})):(this.console.style.display="none",this.consoleInput.value="",this.enabled=!1,Util.Array(this.game.things).All(function(t){if(t.Pause)return t.Pause(!1)}))},DebugConsole.prototype.Output=function(t,e){return null==e&&(e="white"),t=t.replace(/\n/g,"<br>"),this.consoleOutput.innerHTML+="<p style='color:orange'>TorchDev$</p><p style='color:"+e+"'>"+t+"</p>"},DebugConsole.prototype.ParseCommand=function(){var t,e,i,n,o,r,s,a;if(this.enabled){for(i=this.consoleInput.value,i=i.replace(/\$(.*?)\$/g,function(t){return function(e){var i;return i=e.substring(1,e.length-1),t.variables[i]}}(this)),e=i.split(" ")[0].split("/")[1],t=[],a=i.split(" "),n=o=0,r=a.length;o<r;n=++o)s=a[n],0!==n&&t.push(s);return this.ExecuteCommand(e,t)}},DebugConsole.prototype.ExecuteCommand=function(t,e){var i;return this.commands[t]?(i=this.commands)[t].apply(i,[this].concat(slice.call(e))):void this.Output("Command '"+t+"' does not exist.","red")},DebugConsole.prototype.AddCommand=function(t,e){return this.commands[t]=e},DebugConsole.prototype.LoadDefaultCommands=function(){return this.AddCommand("HELP",function(t){return function(t){return t.Output("type '/HELP' for help\ntype '/FPS' for frame rate\ntype '/TIME' for game time\ntype '/E [statement]' to execute a JavaScript statement\ntype '/RUN [path] to load and execute a JavaScript file'")}}(this)),this.AddCommand("CLEAR",function(t){return function(e){return t.consoleOutput.innerHTML=""}}(this)),this.AddCommand("FPS",function(t){return function(e){return e.Output("Current FPS: "+t.game.fps+"\nAverage FPS: 0")}}(this)),this.AddCommand("TIME",function(t){return function(e){return e.Output("Total Game Time: "+t.game.time+"\nDelta Time: "+t.game.deltaTime)}}(this)),this.AddCommand("RUN",function(_this){return function(tConsole,filePath){var loader;return loader=new Torch.AjaxLoader(filePath,Torch.AjaxData.Text),loader.Finish(function(data){var error;try{return eval(data),tConsole.Output("File Executed","green")}catch(t){return error=t,tConsole.Output("File: '"+statement+"' caused an error. "+error,"red")}}),loader.Load()}}(this)),this.AddCommand("SET",function(t){return function(e,i,n){return isNaN(n)?t.variables[i]=n:t.variables[i]=parseFloat(n),t.Output("Set "+i+" to "+n,"green")}}(this)),this.AddCommand("E",function(_this){return function(tConsole,statement){var error;try{return eval(statement),tConsole.Output("Statment Executed","green")}catch(t){return error=t,tConsole.Output("Statement: '"+statement+"' caused an error. "+error,"red")}}}(this))},DebugConsole}()),temp=null,this.PF&&(temp=this.PF),!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.PF=t()}}(function(){return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return o(i?i:t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){e.exports=t("./lib/heap")},{"./lib/heap":2}],2:[function(t,e,i){(function(){var t,i,n,o,r,s,a,h,u,p,l,c,d,f,g;n=Math.floor,p=Math.min,i=function(t,e){return t<e?-1:t>e?1:0},u=function(t,e,o,r,s){var a;if(null==o&&(o=0),null==s&&(s=i),o<0)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);o<r;)a=n((o+r)/2),s(e,t[a])<0?r=a:o=a+1;return[].splice.apply(t,[o,o-o].concat(e)),e},s=function(t,e,n){return null==n&&(n=i),t.push(e),f(t,0,t.length-1,n)},r=function(t,e){var n,o;return null==e&&(e=i),n=t.pop(),t.length?(o=t[0],t[0]=n,g(t,0,e)):o=n,o},h=function(t,e,n){var o;return null==n&&(n=i),o=t[0],t[0]=e,g(t,0,n),o},a=function(t,e,n){var o;return null==n&&(n=i),t.length&&n(t[0],e)<0&&(o=[t[0],e],e=o[0],t[0]=o[1],g(t,0,n)),e},o=function(t,e){var o,r,s,a,h,u;for(null==e&&(e=i),a=function(){u=[];for(var e=0,i=n(t.length/2);0<=i?e<i:e>i;0<=i?e++:e--)u.push(e);return u}.apply(this).reverse(),h=[],r=0,s=a.length;r<s;r++)o=a[r],h.push(g(t,o,e));return h},d=function(t,e,n){var o;if(null==n&&(n=i),o=t.indexOf(e),o!==-1)return f(t,0,o,n),g(t,o,n)},l=function(t,e,n){var r,s,h,u,p;if(null==n&&(n=i),s=t.slice(0,e),!s.length)return s;for(o(s,n),p=t.slice(e),h=0,u=p.length;h<u;h++)r=p[h],a(s,r,n);return s.sort(n).reverse()},c=function(t,e,n){var s,a,h,l,c,d,f,g,y,m;if(null==n&&(n=i),10*e<=t.length){if(l=t.slice(0,e).sort(n),!l.length)return l;for(h=l[l.length-1],g=t.slice(e),c=0,f=g.length;c<f;c++)s=g[c],n(s,h)<0&&(u(l,s,0,null,n),l.pop(),h=l[l.length-1]);return l}for(o(t,n),m=[],a=d=0,y=p(e,t.length);0<=y?d<y:d>y;a=0<=y?++d:--d)m.push(r(t,n));return m},f=function(t,e,n,o){var r,s,a;for(null==o&&(o=i),r=t[n];n>e&&(a=n-1>>1,s=t[a],o(r,s)<0);)t[n]=s,n=a;return t[n]=r},g=function(t,e,n){var o,r,s,a,h;for(null==n&&(n=i),r=t.length,h=e,s=t[e],o=2*e+1;o<r;)a=o+1,a<r&&!(n(t[o],t[a])<0)&&(o=a),t[e]=t[o],e=o,o=2*e+1;return t[e]=s,f(t,h,e,n)},t=function(){function t(t){this.cmp=null!=t?t:i,this.nodes=[]}return t.push=s,t.pop=r,t.replace=h,t.pushpop=a,t.heapify=o,t.updateItem=d,t.nlargest=l,t.nsmallest=c,t.prototype.push=function(t){return s(this.nodes,t,this.cmp)},t.prototype.pop=function(){return r(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return this.nodes.indexOf(t)!==-1},t.prototype.replace=function(t){return h(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return a(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return o(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return d(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),("undefined"!=typeof e&&null!==e?e.exports:void 0)?e.exports=t:window.Heap=t}).call(this)},{}],3:[function(t,e,i){var n={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4};e.exports=n},{}],4:[function(t,e,i){function n(t,e,i){var n;"object"!=typeof t?n=t:(e=t.length,n=t[0].length,i=t),this.width=n,this.height=e,this.nodes=this._buildNodes(n,e,i)}var o=t("./Node"),r=t("./DiagonalMovement");n.prototype._buildNodes=function(t,e,i){var n,r,s=new Array(e);for(n=0;n<e;++n)for(s[n]=new Array(t),r=0;r<t;++r)s[n][r]=new o(r,n);if(void 0===i)return s;if(i.length!==e||i[0].length!==t)throw new Error("Matrix size does not fit");for(n=0;n<e;++n)for(r=0;r<t;++r)i[n][r]&&(s[n][r].walkable=!1);return s},n.prototype.getNodeAt=function(t,e){return this.nodes[e][t]},n.prototype.isWalkableAt=function(t,e){return this.isInside(t,e)&&this.nodes[e][t].walkable},n.prototype.isInside=function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},n.prototype.setWalkableAt=function(t,e,i){this.nodes[e][t].walkable=i},n.prototype.getNeighbors=function(t,e){var i=t.x,n=t.y,o=[],s=!1,a=!1,h=!1,u=!1,p=!1,l=!1,c=!1,d=!1,f=this.nodes;if(this.isWalkableAt(i,n-1)&&(o.push(f[n-1][i]),s=!0),this.isWalkableAt(i+1,n)&&(o.push(f[n][i+1]),h=!0),this.isWalkableAt(i,n+1)&&(o.push(f[n+1][i]),p=!0),this.isWalkableAt(i-1,n)&&(o.push(f[n][i-1]),c=!0),e===r.Never)return o;if(e===r.OnlyWhenNoObstacles)a=c&&s,u=s&&h,l=h&&p,d=p&&c;else if(e===r.IfAtMostOneObstacle)a=c||s,u=s||h,l=h||p,d=p||c;else{if(e!==r.Always)throw new Error("Incorrect value of diagonalMovement");a=!0,u=!0,l=!0,d=!0}return a&&this.isWalkableAt(i-1,n-1)&&o.push(f[n-1][i-1]),u&&this.isWalkableAt(i+1,n-1)&&o.push(f[n-1][i+1]),l&&this.isWalkableAt(i+1,n+1)&&o.push(f[n+1][i+1]),d&&this.isWalkableAt(i-1,n+1)&&o.push(f[n+1][i-1]),o},n.prototype.clone=function(){var t,e,i=this.width,r=this.height,s=this.nodes,a=new n(i,r),h=new Array(r);for(t=0;t<r;++t)for(h[t]=new Array(i),e=0;e<i;++e)h[t][e]=new o(e,t,s[t][e].walkable);return a.nodes=h,a},e.exports=n},{"./DiagonalMovement":3,"./Node":6}],5:[function(t,e,i){e.exports={manhattan:function(t,e){return t+e},euclidean:function(t,e){return Math.sqrt(t*t+e*e)},octile:function(t,e){var i=Math.SQRT2-1;return t<e?i*t+e:i*e+t},chebyshev:function(t,e){return Math.max(t,e)}}},{}],6:[function(t,e,i){function n(t,e,i){this.x=t,this.y=e,this.walkable=void 0===i||i}e.exports=n},{}],7:[function(t,e,i){function n(t){for(var e=[[t.x,t.y]];t.parent;)t=t.parent,e.push([t.x,t.y]);return e.reverse()}function o(t,e){var i=n(t),o=n(e);return i.concat(o.reverse())}function r(t){var e,i,n,o,r,s=0;for(e=1;e<t.length;++e)i=t[e-1],n=t[e],o=i[0]-n[0],r=i[1]-n[1],s+=Math.sqrt(o*o+r*r);return s}function s(t,e,i,n){var o,r,s,a,h,u,p=Math.abs,l=[];for(s=p(i-t),a=p(n-e),o=t<i?1:-1,r=e<n?1:-1,h=s-a;;){if(l.push([t,e]),t===i&&e===n)break;u=2*h,u>-a&&(h-=a,t+=o),u<s&&(h+=s,e+=r)}return l}function a(t){var e,i,n,o,r,a,h=[],u=t.length;if(u<2)return h;for(r=0;r<u-1;++r)for(e=t[r],i=t[r+1],n=s(e[0],e[1],i[0],i[1]),o=n.length,a=0;a<o-1;++a)h.push(n[a]);return h.push(t[u-1]),h}function h(t,e){var i,n,o,r,a,h,u,p,l,c,d,f=e.length,g=e[0][0],y=e[0][1],m=e[f-1][0],v=e[f-1][1];for(i=g,n=y,a=[[i,n]],h=2;h<f;++h){for(p=e[h],o=p[0],r=p[1],l=s(i,n,o,r),d=!1,u=1;u<l.length;++u)if(c=l[u],!t.isWalkableAt(c[0],c[1])){d=!0;break}d&&(lastValidCoord=e[h-1],a.push(lastValidCoord),i=lastValidCoord[0],n=lastValidCoord[1])}return a.push([m,v]),a}function u(t){if(t.length<3)return t;var e,i,n,o,r,s,a=[],h=t[0][0],u=t[0][1],p=t[1][0],l=t[1][1],c=p-h,d=l-u;for(r=Math.sqrt(c*c+d*d),c/=r,d/=r,a.push([h,u]),s=2;s<t.length;s++)e=p,i=l,n=c,o=d,p=t[s][0],l=t[s][1],c=p-e,d=l-i,r=Math.sqrt(c*c+d*d),c/=r,d/=r,c===n&&d===o||a.push([e,i]);return a.push([p,l]),a}i.backtrace=n,i.biBacktrace=o,i.pathLength=r,i.interpolate=s,i.expandPath=a,i.smoothenPath=h,i.compressPath=u},{}],8:[function(t,e,i){e.exports={Heap:t("heap"),Node:t("./core/Node"),Grid:t("./core/Grid"),Util:t("./core/Util"),DiagonalMovement:t("./core/DiagonalMovement"),Heuristic:t("./core/Heuristic"),AStarFinder:t("./finders/AStarFinder"),BestFirstFinder:t("./finders/BestFirstFinder"),BreadthFirstFinder:t("./finders/BreadthFirstFinder"),DijkstraFinder:t("./finders/DijkstraFinder"),BiAStarFinder:t("./finders/BiAStarFinder"),BiBestFirstFinder:t("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:t("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:t("./finders/BiDijkstraFinder"),IDAStarFinder:t("./finders/IDAStarFinder"),JumpPointFinder:t("./finders/JumpPointFinder")}},{"./core/DiagonalMovement":3,"./core/Grid":4,"./core/Heuristic":5,"./core/Node":6,"./core/Util":7,"./finders/AStarFinder":9,"./finders/BestFirstFinder":10,"./finders/BiAStarFinder":11,"./finders/BiBestFirstFinder":12,"./finders/BiBreadthFirstFinder":13,"./finders/BiDijkstraFinder":14,"./finders/BreadthFirstFinder":15,"./finders/DijkstraFinder":16,"./finders/IDAStarFinder":17,"./finders/JumpPointFinder":22,heap:1}],9:[function(t,e,i){function n(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.heuristic=t.heuristic||s.manhattan,this.weight=t.weight||1,this.diagonalMovement=t.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=a.OnlyWhenNoObstacles:this.diagonalMovement=a.IfAtMostOneObstacle:this.diagonalMovement=a.Never),this.diagonalMovement===a.Never?this.heuristic=t.heuristic||s.manhattan:this.heuristic=t.heuristic||s.octile}var o=t("heap"),r=t("../core/Util"),s=t("../core/Heuristic"),a=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,s){var a,h,u,p,l,c,d,f,g=new o(function(t,e){return t.f-e.f}),y=s.getNodeAt(t,e),m=s.getNodeAt(i,n),v=this.heuristic,w=this.diagonalMovement,x=this.weight,b=Math.abs,T=Math.SQRT2;for(y.g=0,y.f=0,g.push(y),y.opened=!0;!g.empty();){if(a=g.pop(),a.closed=!0,a===m)return r.backtrace(m);for(h=s.getNeighbors(a,w),p=0,l=h.length;p<l;++p)u=h[p],u.closed||(c=u.x,d=u.y,f=a.g+(c-a.x===0||d-a.y===0?1:T),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||x*v(b(c-i),b(d-n)),u.f=u.g+u.h,u.parent=a,u.opened?g.updateItem(u):(g.push(u),u.opened=!0)))}return[]},e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],10:[function(t,e,i){function n(t){o.call(this,t);var e=this.heuristic;this.heuristic=function(t,i){return 1e6*e(t,i)}}var o=t("./AStarFinder");n.prototype=new o,n.prototype.constructor=n,e.exports=n},{"./AStarFinder":9}],11:[function(t,e,i){function n(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.diagonalMovement=t.diagonalMovement,this.heuristic=t.heuristic||s.manhattan,this.weight=t.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=a.OnlyWhenNoObstacles:this.diagonalMovement=a.IfAtMostOneObstacle:this.diagonalMovement=a.Never),this.diagonalMovement===a.Never?this.heuristic=t.heuristic||s.manhattan:this.heuristic=t.heuristic||s.octile}var o=t("heap"),r=t("../core/Util"),s=t("../core/Heuristic"),a=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,s){var a,h,u,p,l,c,d,f,g=function(t,e){return t.f-e.f},y=new o(g),m=new o(g),v=s.getNodeAt(t,e),w=s.getNodeAt(i,n),x=this.heuristic,b=this.diagonalMovement,T=this.weight,A=Math.abs,S=Math.SQRT2,M=1,C=2;for(v.g=0,v.f=0,y.push(v),v.opened=M,w.g=0,w.f=0,m.push(w),w.opened=C;!y.empty()&&!m.empty();){for(a=y.pop(),a.closed=!0,h=s.getNeighbors(a,b),p=0,l=h.length;p<l;++p)if(u=h[p],!u.closed){if(u.opened===C)return r.biBacktrace(a,u);c=u.x,d=u.y,f=a.g+(c-a.x===0||d-a.y===0?1:S),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||T*x(A(c-i),A(d-n)),u.f=u.g+u.h,u.parent=a,u.opened?y.updateItem(u):(y.push(u),u.opened=M))}for(a=m.pop(),a.closed=!0,h=s.getNeighbors(a,b),p=0,l=h.length;p<l;++p)if(u=h[p],!u.closed){if(u.opened===M)return r.biBacktrace(u,a);c=u.x,d=u.y,f=a.g+(c-a.x===0||d-a.y===0?1:S),(!u.opened||f<u.g)&&(u.g=f,u.h=u.h||T*x(A(c-t),A(d-e)),u.f=u.g+u.h,u.parent=a,u.opened?m.updateItem(u):(m.push(u),u.opened=C))}}return[]},e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}],12:[function(t,e,i){function n(t){o.call(this,t);var e=this.heuristic;this.heuristic=function(t,i){return 1e6*e(t,i)}}var o=t("./BiAStarFinder");n.prototype=new o,n.prototype.constructor=n,e.exports=n},{"./BiAStarFinder":11}],13:[function(t,e,i){function n(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.diagonalMovement=t.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=r.OnlyWhenNoObstacles:this.diagonalMovement=r.IfAtMostOneObstacle:this.diagonalMovement=r.Never)}var o=t("../core/Util"),r=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,r){var s,a,h,u,p,l=r.getNodeAt(t,e),c=r.getNodeAt(i,n),d=[],f=[],g=this.diagonalMovement,y=0,m=1;for(d.push(l),l.opened=!0,l.by=y,f.push(c),c.opened=!0,c.by=m;d.length&&f.length;){for(h=d.shift(),h.closed=!0,s=r.getNeighbors(h,g),u=0,p=s.length;u<p;++u)if(a=s[u],!a.closed)if(a.opened){if(a.by===m)return o.biBacktrace(h,a)}else d.push(a),a.parent=h,a.opened=!0,a.by=y;for(h=f.shift(),h.closed=!0,s=r.getNeighbors(h,g),u=0,p=s.length;u<p;++u)if(a=s[u],!a.closed)if(a.opened){if(a.by===y)return o.biBacktrace(a,h)}else f.push(a),a.parent=h,a.opened=!0,a.by=m}return[]},e.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],14:[function(t,e,i){function n(t){o.call(this,t),this.heuristic=function(t,e){return 0}}var o=t("./BiAStarFinder");n.prototype=new o,n.prototype.constructor=n,e.exports=n},{"./BiAStarFinder":11}],15:[function(t,e,i){function n(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.diagonalMovement=t.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=r.OnlyWhenNoObstacles:this.diagonalMovement=r.IfAtMostOneObstacle:this.diagonalMovement=r.Never)}var o=t("../core/Util"),r=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,r){var s,a,h,u,p,l=[],c=this.diagonalMovement,d=r.getNodeAt(t,e),f=r.getNodeAt(i,n);for(l.push(d),d.opened=!0;l.length;){if(h=l.shift(),h.closed=!0,h===f)return o.backtrace(f);for(s=r.getNeighbors(h,c),u=0,p=s.length;u<p;++u)a=s[u],a.closed||a.opened||(l.push(a),a.opened=!0,a.parent=h)}return[]},e.exports=n},{"../core/DiagonalMovement":3,"../core/Util":7}],16:[function(t,e,i){function n(t){o.call(this,t),this.heuristic=function(t,e){return 0}}var o=t("./AStarFinder");n.prototype=new o,n.prototype.constructor=n,e.exports=n},{"./AStarFinder":9}],17:[function(t,e,i){function n(t){t=t||{},this.allowDiagonal=t.allowDiagonal,this.dontCrossCorners=t.dontCrossCorners,this.diagonalMovement=t.diagonalMovement,this.heuristic=t.heuristic||o.manhattan,this.weight=t.weight||1,this.trackRecursion=t.trackRecursion||!1,this.timeLimit=t.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=s.OnlyWhenNoObstacles:this.diagonalMovement=s.IfAtMostOneObstacle:this.diagonalMovement=s.Never),this.diagonalMovement===s.Never?this.heuristic=t.heuristic||o.manhattan:this.heuristic=t.heuristic||o.octile}var o=(t("../core/Util"),t("../core/Heuristic")),r=t("../core/Node"),s=t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,o){var s,a,h,u=0,p=(new Date).getTime(),l=function(t,e){return this.heuristic(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}.bind(this),c=function(t,e){
return t.x===e.x||t.y===e.y?1:Math.SQRT2},d=function(t,e,i,n,s){if(u++,this.timeLimit>0&&(new Date).getTime()-p>1e3*this.timeLimit)return 1/0;var a=e+l(t,g)*this.weight;if(a>i)return a;if(t==g)return n[s]=[t.x,t.y],t;var h,f,y,m,v=o.getNeighbors(t,this.diagonalMovement);for(y=0,h=1/0;m=v[y];++y){if(this.trackRecursion&&(m.retainCount=m.retainCount+1||1,m.tested!==!0&&(m.tested=!0)),f=d(m,e+c(t,m),i,n,s+1),f instanceof r)return n[s]=[t.x,t.y],f;this.trackRecursion&&0===--m.retainCount&&(m.tested=!1),f<h&&(h=f)}return h}.bind(this),f=o.getNodeAt(t,e),g=o.getNodeAt(i,n),y=l(f,g);for(s=0;!0;++s){if(a=[],h=d(f,0,y,a,0),h===1/0)return[];if(h instanceof r)return a;y=h}return[]},e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Node":6,"../core/Util":7}],18:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./JumpPointFinderBase"),r=t("../core/DiagonalMovement");n.prototype=new o,n.prototype.constructor=n,n.prototype._jump=function(t,e,i,n){var o=this.grid,r=t-i,s=e-n;if(!o.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(o.getNodeAt(t,e).tested=!0),o.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==r&&0!==s){if(o.isWalkableAt(t-r,e+s)&&!o.isWalkableAt(t-r,e)||o.isWalkableAt(t+r,e-s)&&!o.isWalkableAt(t,e-s))return[t,e];if(this._jump(t+r,e,t,e)||this._jump(t,e+s,t,e))return[t,e]}else if(0!==r){if(o.isWalkableAt(t+r,e+1)&&!o.isWalkableAt(t,e+1)||o.isWalkableAt(t+r,e-1)&&!o.isWalkableAt(t,e-1))return[t,e]}else if(o.isWalkableAt(t+1,e+s)&&!o.isWalkableAt(t+1,e)||o.isWalkableAt(t-1,e+s)&&!o.isWalkableAt(t-1,e))return[t,e];return this._jump(t+r,e+s,t,e)},n.prototype._findNeighbors=function(t){var e,i,n,o,s,a,h,u,p=t.parent,l=t.x,c=t.y,d=this.grid,f=[];if(p)e=p.x,i=p.y,n=(l-e)/Math.max(Math.abs(l-e),1),o=(c-i)/Math.max(Math.abs(c-i),1),0!==n&&0!==o?(d.isWalkableAt(l,c+o)&&f.push([l,c+o]),d.isWalkableAt(l+n,c)&&f.push([l+n,c]),d.isWalkableAt(l+n,c+o)&&f.push([l+n,c+o]),d.isWalkableAt(l-n,c)||f.push([l-n,c+o]),d.isWalkableAt(l,c-o)||f.push([l+n,c-o])):0===n?(d.isWalkableAt(l,c+o)&&f.push([l,c+o]),d.isWalkableAt(l+1,c)||f.push([l+1,c+o]),d.isWalkableAt(l-1,c)||f.push([l-1,c+o])):(d.isWalkableAt(l+n,c)&&f.push([l+n,c]),d.isWalkableAt(l,c+1)||f.push([l+n,c+1]),d.isWalkableAt(l,c-1)||f.push([l+n,c-1]));else for(s=d.getNeighbors(t,r.Always),h=0,u=s.length;h<u;++h)a=s[h],f.push([a.x,a.y]);return f},e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],19:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./JumpPointFinderBase"),r=t("../core/DiagonalMovement");n.prototype=new o,n.prototype.constructor=n,n.prototype._jump=function(t,e,i,n){var o=this.grid,r=t-i,s=e-n;if(!o.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(o.getNodeAt(t,e).tested=!0),o.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==r&&0!==s){if(o.isWalkableAt(t-r,e+s)&&!o.isWalkableAt(t-r,e)||o.isWalkableAt(t+r,e-s)&&!o.isWalkableAt(t,e-s))return[t,e];if(this._jump(t+r,e,t,e)||this._jump(t,e+s,t,e))return[t,e]}else if(0!==r){if(o.isWalkableAt(t+r,e+1)&&!o.isWalkableAt(t,e+1)||o.isWalkableAt(t+r,e-1)&&!o.isWalkableAt(t,e-1))return[t,e]}else if(o.isWalkableAt(t+1,e+s)&&!o.isWalkableAt(t+1,e)||o.isWalkableAt(t-1,e+s)&&!o.isWalkableAt(t-1,e))return[t,e];return o.isWalkableAt(t+r,e)||o.isWalkableAt(t,e+s)?this._jump(t+r,e+s,t,e):null},n.prototype._findNeighbors=function(t){var e,i,n,o,s,a,h,u,p=t.parent,l=t.x,c=t.y,d=this.grid,f=[];if(p)e=p.x,i=p.y,n=(l-e)/Math.max(Math.abs(l-e),1),o=(c-i)/Math.max(Math.abs(c-i),1),0!==n&&0!==o?(d.isWalkableAt(l,c+o)&&f.push([l,c+o]),d.isWalkableAt(l+n,c)&&f.push([l+n,c]),(d.isWalkableAt(l,c+o)||d.isWalkableAt(l+n,c))&&f.push([l+n,c+o]),!d.isWalkableAt(l-n,c)&&d.isWalkableAt(l,c+o)&&f.push([l-n,c+o]),!d.isWalkableAt(l,c-o)&&d.isWalkableAt(l+n,c)&&f.push([l+n,c-o])):0===n?d.isWalkableAt(l,c+o)&&(f.push([l,c+o]),d.isWalkableAt(l+1,c)||f.push([l+1,c+o]),d.isWalkableAt(l-1,c)||f.push([l-1,c+o])):d.isWalkableAt(l+n,c)&&(f.push([l+n,c]),d.isWalkableAt(l,c+1)||f.push([l+n,c+1]),d.isWalkableAt(l,c-1)||f.push([l+n,c-1]));else for(s=d.getNeighbors(t,r.IfAtMostOneObstacle),h=0,u=s.length;h<u;++h)a=s[h],f.push([a.x,a.y]);return f},e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],20:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./JumpPointFinderBase"),r=t("../core/DiagonalMovement");n.prototype=new o,n.prototype.constructor=n,n.prototype._jump=function(t,e,i,n){var o=this.grid,r=t-i,s=e-n;if(!o.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(o.getNodeAt(t,e).tested=!0),o.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==r&&0!==s){if(this._jump(t+r,e,t,e)||this._jump(t,e+s,t,e))return[t,e]}else if(0!==r){if(o.isWalkableAt(t,e-1)&&!o.isWalkableAt(t-r,e-1)||o.isWalkableAt(t,e+1)&&!o.isWalkableAt(t-r,e+1))return[t,e]}else if(0!==s&&(o.isWalkableAt(t-1,e)&&!o.isWalkableAt(t-1,e-s)||o.isWalkableAt(t+1,e)&&!o.isWalkableAt(t+1,e-s)))return[t,e];return o.isWalkableAt(t+r,e)&&o.isWalkableAt(t,e+s)?this._jump(t+r,e+s,t,e):null},n.prototype._findNeighbors=function(t){var e,i,n,o,s,a,h,u,p=t.parent,l=t.x,c=t.y,d=this.grid,f=[];if(p)if(e=p.x,i=p.y,n=(l-e)/Math.max(Math.abs(l-e),1),o=(c-i)/Math.max(Math.abs(c-i),1),0!==n&&0!==o)d.isWalkableAt(l,c+o)&&f.push([l,c+o]),d.isWalkableAt(l+n,c)&&f.push([l+n,c]),d.isWalkableAt(l,c+o)&&d.isWalkableAt(l+n,c)&&f.push([l+n,c+o]);else{var g;if(0!==n){g=d.isWalkableAt(l+n,c);var y=d.isWalkableAt(l,c+1),m=d.isWalkableAt(l,c-1);g&&(f.push([l+n,c]),y&&f.push([l+n,c+1]),m&&f.push([l+n,c-1])),y&&f.push([l,c+1]),m&&f.push([l,c-1])}else if(0!==o){g=d.isWalkableAt(l,c+o);var v=d.isWalkableAt(l+1,c),w=d.isWalkableAt(l-1,c);g&&(f.push([l,c+o]),v&&f.push([l+1,c+o]),w&&f.push([l-1,c+o])),v&&f.push([l+1,c]),w&&f.push([l-1,c])}}else for(s=d.getNeighbors(t,r.OnlyWhenNoObstacles),h=0,u=s.length;h<u;++h)a=s[h],f.push([a.x,a.y]);return f},e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],21:[function(t,e,i){function n(t){o.call(this,t)}var o=t("./JumpPointFinderBase"),r=t("../core/DiagonalMovement");n.prototype=new o,n.prototype.constructor=n,n.prototype._jump=function(t,e,i,n){var o=this.grid,r=t-i,s=e-n;if(!o.isWalkableAt(t,e))return null;if(this.trackJumpRecursion===!0&&(o.getNodeAt(t,e).tested=!0),o.getNodeAt(t,e)===this.endNode)return[t,e];if(0!==r){if(o.isWalkableAt(t,e-1)&&!o.isWalkableAt(t-r,e-1)||o.isWalkableAt(t,e+1)&&!o.isWalkableAt(t-r,e+1))return[t,e]}else{if(0===s)throw new Error("Only horizontal and vertical movements are allowed");if(o.isWalkableAt(t-1,e)&&!o.isWalkableAt(t-1,e-s)||o.isWalkableAt(t+1,e)&&!o.isWalkableAt(t+1,e-s))return[t,e];if(this._jump(t+1,e,t,e)||this._jump(t-1,e,t,e))return[t,e]}return this._jump(t+r,e+s,t,e)},n.prototype._findNeighbors=function(t){var e,i,n,o,s,a,h,u,p=t.parent,l=t.x,c=t.y,d=this.grid,f=[];if(p)e=p.x,i=p.y,n=(l-e)/Math.max(Math.abs(l-e),1),o=(c-i)/Math.max(Math.abs(c-i),1),0!==n?(d.isWalkableAt(l,c-1)&&f.push([l,c-1]),d.isWalkableAt(l,c+1)&&f.push([l,c+1]),d.isWalkableAt(l+n,c)&&f.push([l+n,c])):0!==o&&(d.isWalkableAt(l-1,c)&&f.push([l-1,c]),d.isWalkableAt(l+1,c)&&f.push([l+1,c]),d.isWalkableAt(l,c+o)&&f.push([l,c+o]));else for(s=d.getNeighbors(t,r.Never),h=0,u=s.length;h<u;++h)a=s[h],f.push([a.x,a.y]);return f},e.exports=n},{"../core/DiagonalMovement":3,"./JumpPointFinderBase":23}],22:[function(t,e,i){function n(t){return t=t||{},t.diagonalMovement===o.Never?new r(t):t.diagonalMovement===o.Always?new s(t):t.diagonalMovement===o.OnlyWhenNoObstacles?new a(t):new h(t)}var o=t("../core/DiagonalMovement"),r=t("./JPFNeverMoveDiagonally"),s=t("./JPFAlwaysMoveDiagonally"),a=t("./JPFMoveDiagonallyIfNoObstacles"),h=t("./JPFMoveDiagonallyIfAtMostOneObstacle");e.exports=n},{"../core/DiagonalMovement":3,"./JPFAlwaysMoveDiagonally":18,"./JPFMoveDiagonallyIfAtMostOneObstacle":19,"./JPFMoveDiagonallyIfNoObstacles":20,"./JPFNeverMoveDiagonally":21}],23:[function(t,e,i){function n(t){t=t||{},this.heuristic=t.heuristic||s.manhattan,this.trackJumpRecursion=t.trackJumpRecursion||!1}var o=t("heap"),r=t("../core/Util"),s=t("../core/Heuristic");t("../core/DiagonalMovement");n.prototype.findPath=function(t,e,i,n,s){var a,h=this.openList=new o(function(t,e){return t.f-e.f}),u=this.startNode=s.getNodeAt(t,e),p=this.endNode=s.getNodeAt(i,n);for(this.grid=s,u.g=0,u.f=0,h.push(u),u.opened=!0;!h.empty();){if(a=h.pop(),a.closed=!0,a===p)return r.expandPath(r.backtrace(p));this._identifySuccessors(a)}return[]},n.prototype._identifySuccessors=function(t){var e,i,n,o,r,a,h,u,p,l,c=this.grid,d=this.heuristic,f=this.openList,g=this.endNode.x,y=this.endNode.y,m=t.x,v=t.y,w=Math.abs;Math.max;for(e=this._findNeighbors(t),o=0,r=e.length;o<r;++o)if(i=e[o],n=this._jump(i[0],i[1],m,v)){if(a=n[0],h=n[1],l=c.getNodeAt(a,h),l.closed)continue;u=s.octile(w(a-m),w(h-v)),p=t.g+u,(!l.opened||p<l.g)&&(l.g=p,l.h=l.h||d(w(a-g),w(h-y)),l.f=l.g+l.h,l.parent=t,l.opened?f.updateItem(l):(f.push(l),l.opened=!0))}},e.exports=n},{"../core/DiagonalMovement":3,"../core/Heuristic":5,"../core/Util":7,heap:1}]},{},[8])(8)}),TorchModule(this.PF,"PF"),this.PF=temp,BodyManager=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.velocity=new Vector(0,0),this.acceleration=new Vector(0,0),this.omega=0,this.alpha=0,this.distance=0,this.orbit=null}return t.prototype.Update=function(){var t,e;if(t=this.velocity.x*this.game.Loop.updateDelta,e=this.velocity.y*this.game.Loop.updateDelta,this.distance+=Math.sqrt(t*t+e*e),this.sprite.position.x+=t,this.sprite.position.y+=e,this.velocity.x+=this.acceleration.x*this.game.Loop.updateDelta,this.velocity.y+=this.acceleration.y*this.game.Loop.updateDelta,this.sprite.rotation+=this.omega*this.game.Loop.updateDelta,this.sprite.omega+=this.alpha*this.game.Loop.updateDelta,null!=this.orbit)return this.orbit.Update()},t.prototype.Orbit=function(t,e,i){var n;return this.orbit=new Orbit(this.sprite,t,e,i),n=this.orbit.GetStartPosition(),this.sprite.game.Tweens.Tween(this.sprite.position,2e3,Torch.Easing.Smooth).To({x:n.x,y:n.y}).On("Finish",function(t){return function(){return t.orbit.enabled=!0}}(this))},t.prototype.Debug=function(t){return null==t&&(t="red"),this.DEBUG=t},t.prototype.AngleTo=function(t){var e;return e=this.DirectionTo(t),e.angle},t.prototype.DistanceTo=function(t){var e,i;return i=new Vector(this.sprite.position.x,this.sprite.position.y),e=new Vector(t.position.x,t.position.y),e.SubtractVector(i),e.magnitude},t.prototype.DirectionTo=function(t){var e;return e=new Vector(t.position.x-this.sprite.position.x,t.position.y-this.sprite.position.y),e.Normalize(),e},t}(),Orbit=function(){function t(t,e,i,n){this.sprite=t,this.spriteToOrbit=e,this.orbitSpeed=i,this.orbitLength=n,this.game=this.sprite.game}return t.prototype.sprite=null,t.prototype.game=null,t.prototype.spriteToOrbit=null,t.prototype.enabled=!1,t.prototype.orbitSpeed=0,t.prototype.orbitAngle=0,t.prototype.orbitLength=0,t.prototype.Update=function(){if(this.enabled)return this.orbitAngle+=this.orbitSpeed*this.game.Loop.updateDelta,this.sprite.position.x=this.orbitLength*Math.cos(this.orbitAngle)+(this.spriteToOrbit.position.x+this.spriteToOrbit.rectangle.width/2),this.sprite.position.y=this.orbitLength*Math.sin(this.orbitAngle)+(this.spriteToOrbit.position.y+this.spriteToOrbit.rectangle.height/2)},t.prototype.GetStartPosition=function(){var t,e;return t=this.orbitLength*Math.cos(0)+(this.spriteToOrbit.position.x+this.spriteToOrbit.rectangle.width/2),e=this.orbitLength*Math.sin(0)+(this.spriteToOrbit.position.y+this.spriteToOrbit.rectangle.height/2),new Vector(t,e)},t}(),SizeManager=function(){function t(t){var e;this.sprite=t,e=this.sprite.rectangle,this.width=e.width,this.height=e.height,this.scale={width:1,height:1}}return t.prototype.width=0,t.prototype.height=0,t.prototype.scale=null,t.prototype.Update=function(){var t;if(t=this.sprite.rectangle,this.sprite.torch_shape)return t.width=this.sprite.width,t.height=this.sprite.height},t.prototype.Set=function(t,e){return this.width=this.sprite.rectangle.width=t*this.scale.width,this.height=this.sprite.rectangle.height=e*this.scale.height},t.prototype.Scale=function(t,e){var i;return i=this.sprite.rectangle,this.scale.width=t,this.scale.height=e,i.width=this.width*this.scale.width,i.height=this.height*this.scale.height},t}(),EventManager=function(){function t(t){this.sprite=t,this.game=this.sprite.game}return t.prototype.mouseOver=!1,t.prototype.clickTrigger=!1,t.prototype.clickAwayTrigger=!1,t.prototype.draw=!0,t.prototype.wasClicked=!1,t.prototype.Update=function(){var t,e;return!this.game.Mouse.GetRectangle().Intersects(this.sprite.rectangle)&&this.mouseOver&&(this.mouseOver=!1,this.sprite.Emit("MouseLeave",new Torch.Event(this.game,{sprite:this.sprite}))),this.game.Mouse.GetRectangle().Intersects(this.sprite.rectangle)?(this.mouseOver||this.sprite.Emit("MouseOver",new Torch.Event(this.game,{sprite:this.sprite})),this.mouseOver=!0):this.sprite.fixed?(t=this.game.Mouse.GetRectangle(),e=new Rectangle(t.x,t.y,t.width,t.height),e.x+=this.game.Camera.position.x,e.y+=this.game.Camera.position.y,e.Intersects(this.sprite.rectangle)?this.mouseOver=!0:this.mouseOver=!1):this.mouseOver=!1,this.mouseOver&&this.game.Mouse.down&&!this.clickTrigger&&(this.clickTrigger=!0,this.sprite.Emit("MouseDown",new Torch.Event(this.game,{sprite:this.sprite}))),this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver&&(this.wasClicked=!0,this.sprite.Emit("MouseUp",new Torch.Event(this.game,{sprite:this.sprite})),this.sprite.Emit("Click",new Torch.Event(this.game,{sprite:this.sprite})),this.clickTrigger=!1),!this.clickTrigger||this.game.Mouse.down||this.mouseOver||(this.clickTrigger=!1),this.game.Mouse.down||this.mouseOver||!this.clickAwayTrigger?this.clickTrigger&&!this.game.Mouse.down&&this.mouseOver?this.clickAwayTrigger=!1:this.game.Mouse.down&&!this.mouseOver?this.clickAwayTrigger=!0:void 0:(this.sprite.Emit("ClickAway",new Torch.Event(this.game,{sprite:this.sprite})),this.wasClicked=!1,this.clickAwayTrigger=!1)},t}(),EffectManager=function(){function t(t){this.sprite=t,this.effects=[],this.tint=new EffectComponent.Tint,this.mask=new EffectComponent.Mask}return t.prototype.tint=null,t.prototype.mask=null,t.prototype.effects=null,t.prototype.Update=function(){var t;return this.effects=function(){var e,i,n,o;for(n=this.effects,o=[],e=0,i=n.length;e<i;e++)t=n[e],t.Update(),t.trash?o.push(void 0):o.push(t);return o}.call(this)},t.prototype.Blink=function(t){var e;return null==t&&(t=300),e=this.sprite.game.Tweens.Tween(this.sprite,t,Torch.Easing.Smooth).To({opacity:0}).Cycle()},t.prototype.Flash=function(t,e){var i;return null==t&&(t="red"),null==e&&(e=100),this.tint.color=t,i=this.sprite.game.Tweens.Tween(this.tint,e,Torch.Easing.Smooth).From({opacity:0}).To({opacity:1}),i.On("Finish",function(t){return function(){var i;return i=t.sprite.game.Tweens.Tween(t.tint,e,Torch.Easing.Smooth).To({opacity:0}),i.On("Finish",function(){return t.tint.color=null,t.tint.opacity=.5})}}(this))},t.prototype.Crumple=function(t,e){var i;return i=this.sprite.rectangle.height*t,this.sprite.game.Tweens.Tween(this.sprite.rectangle,e,Torch.Easing.Smooth).To({height:i})},t.prototype.Stretch=function(t,e){var i;return i=this.sprite.rectangle.width*t,this.sprite.game.Tweens.Tween(this.sprite.rectangle,e,Torch.Easing.Smooth).To({width:i})},t.prototype.Squirt=function(t,e){var i,n,o,r,s;return o=this.sprite.rectangle.width,n=this.sprite.rectangle.height,s=Math.abs(t.x-this.sprite.position.x),i=Math.abs(t.y-this.sprite.position.y),s>0&&this.sprite.game.Tweens.Tween(this.sprite.rectangle,e,Torch.Easing.Smooth).To({width:s}),i>0&&this.sprite.game.Tweens.Tween(this.sprite.rectangle,e,Torch.Easing.Smooth).To({height:i}),r=this.sprite.game.Tweens.Tween(this.sprite.position,e,Torch.Easing.Smooth).To({x:t.x,y:t.y}),r.On("Finish",function(t){return function(){return t.sprite.game.Tweens.Tween(t.sprite.rectangle,e,Torch.Easing.Smooth).To({width:o,height:n})}}(this))},t.prototype.Trail=function(){return this.effects.push(new TrailEffect(this.sprite))},t}(),EffectComponent={},EffectComponent.Tint=function(){function t(){}return t.prototype._color=null,t.prototype._opacity=.5,t.property("color",{get:function(){return this._color},set:function(t){return this._color=t}}),t.property("opacity",{get:function(){return this._opacity},set:function(t){return this._opacity=t}}),t}(),EffectComponent.Mask=function(){function t(){}return t.prototype._texture=null,t.prototype._in=!1,t.prototype._out=!1,t.property("texture",{get:function(){return this._texture},set:function(t){return this._texture=t}}),t.property("in",{get:function(){return this._in},set:function(t){return this._in=t}}),t.property("out",{get:function(){return this._out},set:function(t){return this._out=t}}),t}(),TrailEffect=function(){function t(t){this.sprite=t}return t.prototype.fadeTime=200,t.prototype.Update=function(){var t;return t=new Sprite(this.sprite.game,this.sprite.position.x,this.sprite.position.y),t.Bind.Texture(this.sprite.texture.image),t.Size.Scale(1,1),t.drawIndex=this.sprite.drawIndex-1,t.rotation=this.sprite.rotation,this.sprite.game.Tweens.Tween(t,this.fadeTime,Torch.Easing.Smooth).From({opacity:.2}).To({opacity:0}).On("Finish",function(e){return function(){return t.Trash()}}(this))},t}(),StateMachineManager=function(){function t(t){this.sprite=t,this.stateMachines={}}return t.prototype.CreateStateMachine=function(t){return this.stateMachines[t]=new StateMachine(this.sprite),this.stateMachines[t]},t.prototype.GetStateMachine=function(t){return this.stateMachines[t]},t.prototype.Update=function(){var t,e,i,n;e=this.stateMachines,i=[];for(t in e)n=e[t],i.push(n.Update());return i},t}(),GridManager=function(){function t(t){this.sprite=t,this.position=new Point(0,0),this.children=[],this.margin={left:0,top:0}}return t.prototype.parent=null,t.prototype.children=null,t.prototype.centered=!1,t.prototype.centerVertical=!1,t.prototype.alignLeft=!1,t.prototype.alignRight=!1,t.prototype.alignTop=!1,t.prototype.alignBottom=!1,t.prototype.margin=null,t.prototype.Align=function(){var t,e,i,n;for(i=1<=arguments.length?slice.call(arguments,0):[],t=0,e=i.length;t<e;t++)switch(n=i[t]){case"left":this.alignLeft=!0;break;case"right":this.alignRight=!0;break;case"top":this.alignTop=!0;break;case"bottom":this.alignBottom=!0}return this},t.prototype.Center=function(t){return null==t&&(t=!0),this.centered=t,this},t.prototype.CenterVertical=function(t){return null==t&&(t=!0),this.centerVertical=t,this},t.prototype.Margin=function(t,e){return null==t&&(t=0),null==e&&(e=0),this.margin.left=t,this.margin.top=e,this},t.prototype.Append=function(t){return t.Grid.parent=this.sprite,t.drawIndex=this.sprite.drawIndex+1,t.fixed=this.sprite.fixed,this},t.prototype.Parent=function(){return this.parent},t.prototype.Children=function(t){var e,i,n,o,r,s,a,h;if(!t)return this.children;for(i=[],a=this.children,n=0,r=a.length;n<r;n++){e=a[n],s=!0;for(o in t)h=t[o],!e[o]===h&&(s=!1);s&&i.append(e)}return i},t.prototype.Ancestors=function(t){var e,i,n,o,r,s;if(!this.parent)return null;for(i=[],e=this.parent,r=[];null!==e.Parent();){if(t){o=!0;for(n in t)s=t[n],e[n]!==s&&(o=!1);o&&i.push(e)}else i.push(e);r.push(e=e.Parent())}return r},t.prototype.ApplyCentering=function(t){return this.centered&&(t.x=t.x+this.parent.rectangle.width/2-this.sprite.rectangle.width/2),this.centerVertical&&(t.y=t.y+this.parent.rectangle.height/2-this.sprite.rectangle.height/2),t},t.prototype.ApplyAlignment=function(t){return this.alignLeft&&(t.x=0),this.alignRight&&(t.x=t.x+(this.parent.rectangle.width-this.sprite.rectangle.width)),this.alignTop&&(t.y=0),this.alignBottom&&(t.y=t.y+(this.parent.rectangle.height-this.sprite.rectangle.height)),t},t.prototype.ResolveAbosolutePosition=function(){var t;return null===this.parent?this.sprite.position:(t=this.parent.position.Clone(),t=this.ApplyCentering(t),t=this.ApplyAlignment(t),t.x+=this.position.x,t.y+=this.position.y,t.x+=this.margin.left,t.y+=this.margin.top,t)},t.prototype.Update=function(){if(this.sprite.position=this.ResolveAbosolutePosition(),null!==this.parent)return this.sprite.drawIndex=this.parent.drawIndex+1,this.sprite.fixed=this.parent.fixed},t}(),Animation=function(t){function e(){this.InitEventDispatch()}return extend(e,t),e.MixIn(Trashable),e.MixIn(EventDispatcher),e.prototype.loop=!1,e.prototype.stopped=!1,e.prototype.intervalTime=0,e.prototype.stepTime=0,e.prototype.Loop=function(){return this.loop=!0,this},e}(Trashable),AnimationManager=function(){function t(t){this.sprite=t,this.animations=[]}return t.prototype.animations=null,t.prototype.Update=function(){var t,e,i,n,o;for(e=[],o=this.animations,i=0,n=o.length;i<n;i++)t=o[i],t.Update(),t.trash||e.push(t);return this.animations=e},t.prototype.SpriteSheet=function(t,e,i,n){var o;return null==n&&(n={step:200}),o=new SpriteSheetAnimation(this.sprite,t,e,i,n.step),this.animations.push(o),o},t.prototype.AtlasFrame=function(t,e,i,n){var o;return null==n&&(n={step:200}),o=new AtlasFrameAnimation(this.sprite,t,e,i,n.step),this.animations.push(o),o},t}(),SpriteSheetAnimation=function(t){function e(t,i,n,o,r){this.sprite=t,this.clipWidth=i,this.clipHeight=n,this.numberOfFrames=o,this.stepTime=r,e.__super__.constructor.call(this),this.loop=!0,this.game=this.sprite.game,this.Reset()}return extend(e,t),e.prototype.index=-1,e.prototype.clipX=0,e.prototype.clipY=0,e.prototype.game=null,e.prototype.clipWidth=null,e.prototype.clipHeight=null,e.prototype.numberOfFrames=null,e.prototype.stepTime=null,e.prototype.Update=function(){if(!this.stopped)return this.intervalTime+=this.game.Loop.updateDelta,this.intervalTime>=this.stepTime?this.AdvanceFrame():void 0},e.prototype.AdvanceFrame=function(){if(this.intervalTime=0,this.index+=1,this.sprite.texture.drawParams.clipX=this.index*this.clipWidth,this.index>=this.numberOfFrames-1)return this.loop?this.index=-1:this.Trash()},e.prototype.Stop=function(){return this.stopped=!0},e.prototype.Start=function(){return this.stopped=!1},e.prototype.Index=function(t){return this.index=t-1,this.sprite.texture.drawParams.clipX=(this.index+1)*this.clipWidth},e.prototype.Reset=function(){return this.intervalTime=0,this.index=-1,this.sprite.texture.drawParams.clipX=0,this.sprite.texture.drawParams.clipY=0,this.sprite.texture.drawParams.clipWidth=this.clipWidth,this.sprite.texture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e.prototype.SyncFrame=function(){return this.sprite.texture.drawParams.clipX=0,this.sprite.texture.drawParams.clipY=0,this.sprite.texture.drawParams.clipWidth=this.clipWidth,this.sprite.texture.drawParams.clipHeight=this.clipHeight,this.sprite.Size.width=this.clipWidth,this.sprite.Size.height=this.clipHeight},e}(Animation),AtlasFrameAnimation=function(t){function e(t,i,n,o,r){this.sprite=t,this.atlasId=i,this.textureId=n,this.frames=o,this.stepTime=r,e.__super__.constructor.call(this),this.game=this.sprite.game,this.numberOfFrames=this.frames.length}return extend(e,t),e.prototype.index=0,e.prototype.Update=function(){if(!this.stopped)return this.intervalTime+=this.game.Loop.updateDelta,this.intervalTime>=this.stepTime?this.AdvanceFrame():void 0},e.prototype.AdvanceFrame=function(){if(this.intervalTime=0,this.index+=1,this.sprite.Bind.Atlas(this.atlasId,this.textureId,this.frames[this.index]),this.index>=this.numberOfFrames-1)return this.loop?this.index=0:(this.Emit("Finish",new Torch.Event(this.game,{animation:this})),this.Trash())},e}(Animation),BindManager=function(){function t(t){this.sprite=t}return t.prototype.Texture=function(t,e){var i,n,o;if(n=null,o=Util.Type(t),"string"===o)i=this.sprite.game.Assets.GetTexture(t),n=new Texture(i);else{if("object"!==o)throw new ER.ArgumentError("textureId",t,["string","object"]);n=new Texture(t)}return this.sprite.Size.Set(n.width,n.height),this.sprite.texture=n},t.prototype.Video=function(t){var e,i,n;if(i=null,n=Util.Type(t),"string"===n)e=this.sprite.game.Assets.GetVideo(t),i=new Video(e);else{if("object"!==n)throw new ER.ArgumentError("videoId",t,["string","object"]);i=new Video(e)}return this.sprite.video=i,this.sprite.Size.Set(i.width,i.height)},t.prototype.Atlas=function(t,e,i){var n,o;return this.Texture(t),o=this.sprite.game.Assets.GetTextureAtlas(e),n=o.textures[i],this.sprite.texture.drawParams.clipX=n.x,this.sprite.texture.drawParams.clipY=n.y,this.sprite.texture.drawParams.clipWidth=n.width,this.sprite.texture.drawParams.clipHeight=n.height,this.sprite.Size.Set(n.width,n.height)},t}(),CanvasRenderer=function(){function t(t){this.sprite=t,this.game=this.sprite.game,this.previousPosition=new Point(this.sprite.position.x,this.sprite.position.y)}return t.prototype.Draw=function(){var t,e;if(e=new Rectangle(this.sprite.position.x,this.sprite.position.y,this.sprite.rectangle.width,this.sprite.rectangle.height),e.x=(this.sprite.position.x-this.previousPosition.x)*this.game.Loop.lagOffset+this.previousPosition.x,e.y=(this.sprite.position.y-this.previousPosition.y)*this.game.Loop.lagOffset+this.previousPosition.y,this.previousPosition=new Point(this.sprite.position.x,this.sprite.position.y),t=new Point(0,0),this.sprite.fixed||(e.x+=this.game.Camera.position.x+this.game.Hooks.positionTransform.x,e.y+=this.game.Camera.position.y+this.game.Hooks.positionTransform.y),this.sprite.draw)switch(this.sprite.torch_render_type){case"Image":return this.RenderImageSprite(e);case"Line":return this.RenderLineSprite(e);case"Box":return this.RenderBoxSprite(e);case"Circle":return this.RenderCircleSprite(e);case"Polygon":return this.RenderPolygonSprite(e)}},t.prototype.RenderImageSprite=function(t){var e,i,n,o;if(null!=this.sprite.texture||null!=this.sprite.video)return i=this.sprite.texture||this.sprite.video,n=i.drawParams,e=this.game.canvas,e.save(),this.SetCanvasStates(e,t.x+t.width/2,t.y+t.height/2),null!==this.sprite.Effects.tint.color&&(e.fillStyle=this.sprite.Effects.tint.color,e.globalAlpha=this.sprite.Effects.tint.opacity,e.globalCompositeOperation="destination-atop",e.fillRect(-t.width/2,-t.height/2,t.width,t.height),e.globalAlpha=this.sprite.opacity),e.drawImage((null!=(o=this.sprite.video)?o.video:void 0)||this.sprite.texture.image,n.clipX,n.clipY,n.clipWidth,n.clipHeight,-t.width/2+this.sprite.rotationOffset.x,-t.height/2+this.sprite.rotationOffset.y,t.width,t.height),this.sprite.Body.DEBUG&&(e.fillStyle=this.sprite.Body.DEBUG,e.globalAlpha=.5,e.fillRect(-t.width/2,-t.height/2,t.width,t.height)),e.restore()},t.prototype.RenderLineSprite=function(t){var e;return this.game.canvas.save(),this.game.canvas.globalAlpha=this.sprite.opacity,this.game.canvas.strokeStyle=this.sprite.color,this.game.canvas.lineWidth=this.sprite.lineWidth,null!=(null!=(e=this.sprite.DrawTexture)?e.image:void 0)&&(this.game.canvas.strokeStyle=this.game.canvas.createPattern(this.sprite.DrawTexture.image,"repeat")),this.game.canvas.beginPath(),this.game.canvas.moveTo(t.x,t.y),this.game.canvas.lineTo(this.sprite.endPosition.x+this.game.Camera.position.x,this.sprite.endPosition.y+this.game.Camera.position.y),this.game.canvas.stroke(),this.game.canvas.restore()},t.prototype.RenderCircleSprite=function(t){return this.game.canvas.save(),this.game.canvas.translate(t.x+this.sprite.radius/2,t.y+this.sprite.radius/2),this.game.canvas.globalAlpha=this.sprite.opacity,this.game.canvas.strokeStyle=this.sprite.strokeColor,this.game.canvas.fillStyle=this.sprite.fillColor,this.game.canvas.beginPath(),this.game.canvas.arc(0,0,this.sprite.radius,this.sprite.startAngle,this.sprite.endAngle,"counterclockwise"===this.sprite.drawDirection),this.game.canvas.fill(),this.game.canvas.stroke(),this.game.canvas.restore()},t.prototype.RenderBoxSprite=function(t){return this.game.canvas.save(),this.SetCanvasStates(this.game.canvas,t.x+this.sprite.width/2,t.y+this.sprite.height/2),this.game.canvas.beginPath(),this.game.canvas.rect(-this.sprite.width/2,-this.sprite.height/2,this.sprite.width,this.sprite.height),this.game.canvas.fill(),this.game.canvas.stroke(),this.game.canvas.restore()},t.prototype.RenderPolygonSprite=function(t){var e,i,n,o,r;for(this.game.canvas.save(),e=Point.GetCenterPoint(this.sprite.points),this.SetCanvasStates(this.game.canvas,t.x+e.x/2,t.y+e.y/2),this.game.canvas.beginPath(),this.game.canvas.moveTo(0,0),r=this.sprite.points,i=0,n=r.length;i<n;i++)o=r[i],this.game.canvas.lineTo(o.x,o.y);return this.game.canvas.closePath(),this.game.canvas.stroke(),this.game.canvas.fill(),this.game.canvas.restore()},t.prototype.SetCanvasStates=function(t,e,i){return null!=this.sprite.opacity&&(t.globalAlpha=this.sprite.opacity),null!=this.sprite.strokeColor&&(t.strokeStyle=this.sprite.strokeColor),null!=this.sprite.fillColor&&(t.fillStyle=this.sprite.fillColor),t.translate(e,i),t.rotate(this.sprite.rotation)},t}(),TorchModule(Sprite=function(t){function e(t,e,i){this.InitSprite(t,e,i)}return extend(e,t),e.MixIn(EventDispatcher),e.prototype.torch_render_type="Image",e.prototype.torch_type="Sprite",e.prototype.InitSprite=function(t,e,i){var n,o,r;if(null==e&&(e=0),null==i&&(i=0),n=Util.Type(t),o=Util.Type(e),r=Util.Type(i),null==t||"Game"!==n)throw new ER.ArgumentError("game",t,["Torch.Game"]);if("number"!==o)throw new ER.ArgumentError("x",e,["number"]);if("number"!==r)throw new ER.ArgumentError("y",i,["number"]);return this.InitEventDispatch(),this.game=t,this.rectangle=new Rectangle(e,i,0,0),this.position=new Vector(e,i),this.rotationOffset=new Vector(0,0),this.Bind=new BindManager(this),this.Collisions=new CollisionManager(this),this.Body=new BodyManager(this),this.Size=new SizeManager(this),this.Events=new EventManager(this),this.Effects=new EffectManager(this),this.States=new StateMachineManager(this),this.Grid=new GridManager(this),this.Animations=new AnimationManager(this),this.texture=null,this.video=null,this.fixed=!1,this.draw=!0,this.paused=!1,this.drawIndex=0,this.rotation=0,this.opacity=1,this._torch_add="Sprite",this._torch_uid="",this.events={},this.renderer=new CanvasRenderer(this),t.Add(this)},e.prototype.UpdateSprite=function(){if(!this.paused)return this.rectangle.x=this.position.x,this.rectangle.y=this.position.y,this.Body.Update(),this.Size.Update(),this.Events.Update(),this.States.Update(),this.Grid.Update(),this.Animations.Update(),this.Effects.Update(),this.Collisions.Update(),this.game.boundary&&!this.rectangle.Intersects(this.game.boundary)?this.Emit("OutOfBounds",new Event(this.game,{sprite:this})):void 0},e.prototype.Update=function(){return this.UpdateSprite()},e.prototype.Draw=function(){return this.renderer.Draw()},e.prototype.NotSelf=function(t){return t.torch_uid!==this.torch_uid},e.prototype.Wrap=function(){return this.On("OutOfBounds",function(t){return function(){if(t.game.boundary)return t.position.y<t.game.boundary.y&&(t.position.y=t.game.boundary.height-t.rectangle.height),t.position.y>t.game.boundary.height&&(t.position.y=t.game.boundary.y+t.rectangle.height),t.position.x>t.game.boundary.width&&(t.position.x=t.game.boundary.x+t.rectangle.width),t.position.x<t.game.boundary.x?t.position.x=t.game.boundary.width-t.rectangle.width:void 0}}(this))},e.prototype.Clone=function(){return Object.create(this)},e.prototype.Center=function(){var t,e;return t=this.game.canvasNode.width,e=t/2-this.rectangle.width/2,this.position.x=e,this},e.prototype.CenterVertical=function(){var t,e;return t=this.game.canvasNode.height,e=t/2-this.rectangle.height/2,this.position.y=e,this},e.prototype.CollidesWith=function(t){return new CollisionDetector(this,t)},e.prototype.Pause=function(t){return null==t&&(t=!0),this.paused=t},e}(GameThing)),"undefined"!=typeof document&&null!==document?(_measureCanvas=document.createElement("CANVAS"),_measureCanvas.width=500,_measureCanvas.height=500):_measureCanvas={getContext:function(){}},TorchModule(Text=function(t){function e(t,e,i,n){this.InitText(t,e,i,n)}return extend(e,t),e.prototype.TEXT=!0,e.measureCanvas=_measureCanvas.getContext("2d"),e.property("fontSize",{get:function(){return this._fontSize},set:function(t){return this._fontSize=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("font",{
get:function(){return this._font},set:function(t){return this._font=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("fontWeight",{get:function(){return this._fontWeight},set:function(t){return this._fontWeight=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("color",{get:function(){return this._color},set:function(t){return this._color=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.property("text",{get:function(){return this._text},set:function(t){return this._text=t,Util.Function(function(t){return function(){return t.Render()}}(this)).Defer()}}),e.prototype.InitText=function(t,e,i,n){return this.InitSprite(t,e,i),this.data=n,this._font="Arial",this._fontSize=16,this._fontWeight="",this._color="#2b4531",this._text="",this.width=100,this.height=100,this.Size.scale={width:1,height:1},this.Init()},e.prototype.Init=function(){return this.data.font&&(this._font=this.data.font),this.data.fontSize&&(this._fontSize=this.data.fontSize),this.data.fontWeight&&(this._fontWeight=this.data.fontWeight),this.data.color&&(this._color=this.data.color),this.data.text&&(this._text=this.data.text),this.data.rectangle&&(this.rectangle=this.data.rectangle),this.data.buffHeight&&(this.buffHeight=this.data.buffHeight),this.Render()},e.prototype.Render=function(){var t,i,n;return i=document.createElement("CANVAS"),e.measureCanvas.font=this._fontSize+"px "+this._font,i.width=e.measureCanvas.measureText(this._text).width,i.height=this._fontSize,this.buffHeight&&(i.height+=this.buffHeight),t=i.getContext("2d"),t.fillStyle=this._color,t.font=this._fontWeight+" "+this._fontSize+"px "+this._font,t.fillText(this._text,0,i.height),n=new Image,n.src=i.toDataURL(),n.onload=function(t){return function(){return t.Bind.Texture(n)}}(this),this.rectangle.width=i.width,this.rectangle.height=this._fontSize},e.prototype.Update=function(){return e.__super__.Update.call(this)},e}(Sprite)),TorchModule(BitmapText=function(){function t(){}return t}()),Shapes={name:"Shapes"},TorchModule(Shapes),Shapes.Circle=function(t){function e(t,e,i,n,o,r){null==o&&(o="black"),null==r&&(r="black"),this.InitSprite(t,e,i),this.radius=n,this.fillColor=o,this.strokeColor=r}return extend(e,t),e.prototype.torch_render_type="Circle",e.prototype.radius=0,e.prototype.fillColor="black",e.prototype.strokeColor="black",e.prototype.startAngle=0,e.prototype.endAngle=2*Math.PI,e.prototype.drawDirection="clockwise",e}(Sprite),Shapes.Line=function(t){function e(t,e,i,n,o,r,s){this.color=r,this.InitSprite(t,e,i),this.endPosition=new Point(n,o),Util.Object(this).Extend(s)}return extend(e,t),e.prototype.torch_render_type="Line",e.prototype.color="black",e.prototype.lineWidth=1,e.prototype.endPosition=null,e}(Sprite),Shapes.Box=function(t){function e(t,e,i,n,o,r,s){null==r&&(r="black"),null==s&&(s="black"),this.InitSprite(t,e,i),this.width=n,this.height=o,this.fillColor=r,this.strokeColor=s}return extend(e,t),e.prototype.torch_render_type="Box",e.prototype.torch_shape=!0,e.prototype.fillColor="black",e.prototype.strokeColor="black",e.prototype.width=0,e.prototype.height=0,e}(Sprite),Shapes.Polygon=function(t){function e(t,e,i,n,o,r){this.points=n,this.fillColor=o,this.strokeColor=r,this.InitSprite(t,e,i)}return extend(e,t),e.prototype.torch_render_type="Polygon",e.Regular=function(t,e,i,n,o,r,s){var a,h,u,p,l,c;for(h=2*Math.PI/n,u=[],a=0;a<=2*Math.PI;)p=Math.cos(a)*o,l=Math.sin(a)*o,u.push(new Point(p,l)),a+=h;return c=new Shapes.Polygon(t,e,i,u,r,s),c.rectangle.width=c.rectangle.height=o,c},e}(Sprite),TorchModule(SpriteGroup=function(t){function e(t,e,i){this.game=t,this.InitEventDispatch(),this.game.Add(this),this.sprites=[],this.position=new Vector(e,i)}return extend(e,t),e.MixIn(EventDispatcher),e.prototype.sprites=null,e.prototype.position=null,e.prototype.Update=function(){var t,e,i,n,o;for(t=[],n=this.sprites,e=0,i=n.length;e<i;e++)o=n[e],o.trash||t.push(o);if(this.sprites=t,t.length<=0)return this.Emit("Empty",new Event(this.game,{spriteGroup:this}))},e.prototype.Every=function(t){var e,i,n,o,r;for(n=this.sprites,o=[],e=0,i=n.length;e<i;e++)r=n[e],o.push(t(r));return o},e.prototype.Grid=function(t,e,i,n){var o,r,s,a,h,u,p,l,c;for(null==n&&(n=0),r=null,"array"!==Util.Type(t)?s=new t(this.game,this.position.x,this.position.y):(r=t,s=new r[0](this.game,this.position.x,this.position.y)),c=s.rectangle.width,a=s.rectangle.height,s.Trash(),c+=n,a+=n,h=0,l=[];h<e;){for(p=0;p<i;)null===r?o=new t(this.game,this.position.x+h*c,this.position.y+p*a):(u=Util.Math.RandomInRange(0,r.length-1),u=Math.floor(u),console.log(r,u),o=new r[u](this.game,this.position.x+h*c,this.position.y+p*a)),this.sprites.push(o),p++;l.push(h++)}return l},e}(GameThing)),CollisionDetector=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.AABB=function(){return new AABB(this.sprite,this.otherSprite).Execute()},t.prototype.Circle=function(){return new Circle(this.sprite,this.otherSprite).Execute()},t.prototype.SAT=function(){return new SAT(this.sprite,this.otherSprite).Execute()},t}(),AABB=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){return this.sprite.rectangle.Intersects(this.otherSprite.rectangle)},t}(),Circle=function(){function t(t,e){this.sprite=t,this.otherSprite=e}return t.prototype.Execute=function(){var t,e,i,n,o;return t={radius:this.sprite.Width(),x:this.sprite.Position("x"),y:this.sprite.Position("y")},e={radius:this.otherSprite.Width(),x:this.otherSprite.Position("x"),y:this.otherSprite.Position("y")},n=t.x-e.x,o=t.y-e.y,i=Math.sqrt(n*n+o*o),i<t.radius+e.radius},t}(),Collision={AABB:1,Circle:2,SAT:3},CollisionManager=function(){function t(t){this.sprite=t,this.filter={},this.game=this.sprite.game}return t.prototype.mode=Collision.AABB,t.prototype.sprite=null,t.prototype.filter=null,t.prototype.limit=null,t.prototype.enabled=!1,t.prototype.Monitor=function(){return this.enabled=!0},t.prototype.NotFiltered=function(t){var e,i,n,o;i=this.game.filter;for(e in i)if(o=i[e],"__type__"===e){if(o.constructor.name===t.constructor.name)return!1}else if(o===t[e])return!1;n=this.filter;for(e in n)if(o=n[e],"__type__"===e){if(o.constructor.name===t.constructor.name)return!1}else if(o===t[e])return!1;return!0},t.prototype.InLimit=function(t){var e,i,n;i=this.limit;for(e in i)if(n=i[e],"__type__"===e){if(n.constructor.name===t.constructor.name)return!0}else if(n===t[e])return!0;return!1},t.prototype.Valid=function(t){return null!==this.limit?this.InLimit(t):this.NotFiltered(t)},t.prototype.Filter=function(t){return this.filter=t},t.prototype.Limit=function(t){return this.limit=t},t.prototype.Mode=function(t){var e;return e=t},t.prototype.Update=function(){var t,e,i,n,o,r,s;if(this.sprite.game&&this.enabled){for(this.game=this.sprite.game,t=!1,s=this.game.things,n=0,o=s.length;n<o;n++)if(r=s[n],"Sprite"===r.torch_type&&this.sprite.NotSelf(r)&&this.Valid(r)){switch(i=!1,e={},this.mode){case Collision.AABB:e=this.sprite.CollidesWith(r).AABB(),i=e!==!1}i&&(e.self=this.sprite,e.collider=r,this.sprite.Emit("Collision",new Torch.Event(this.game,{collisionData:e})))}return this.sprite.Emit("NoCollision",new Torch.Event(this.game,{}))}},t.prototype.SimpleCollisionHandle=function(t,e){var i,n;return null==e&&(e=1),i=t.collisionData,n={left:!1,right:!1,top:!1,bottom:!1},i.vx<i.halfWidths&&i.vy<i.halfHeights&&(i.x<i.y?i.vx>0?(t.collisionData.self.position.x+=i.x*e,n.left=!0):i.vx<0&&(t.collisionData.self.position.x-=i.x*e,n.right=!0):i.x>i.y&&(i.vy>0?(t.collisionData.self.position.y+=i.y*e,n.top=!0):i.vy<0&&(t.collisionData.self.position.y-=i.y*e,n.bottom=!0))),n},t.prototype.CastRay=function(){},t}(),Loop=function(){function t(t){this.game=t,this.fps=50,this.frameTime=1e3/this.fps,this.lag=0,this.updateDelta=0,this.drawDelta=0,this.lagOffset}return t.prototype.Update=function(){return this.game.update(this.game),this.game.State.Update(),this.game.GamePads.Update(),this.game.UpdateThings()},t.prototype.Draw=function(){return this.game.draw(this.game),this.game.DrawThings()},t.prototype.AdvanceFrame=function(t){var e;for(void 0===this.game.time&&(this.game.time=t),this.game.deltaTime=Math.round(t-this.game.time),this.game.time=t,e=this.game.deltaTime,this.drawDelta=e,this.updateDelta=this.frameTime,e>1e3&&(e=this.frameTime),this.lag+=e;this.lag>=this.frameTime;)this.Update(),this.lag-=this.frameTime;return this.lagOffset=this.lag/this.frameTime,this.Draw(),window.requestAnimationFrame(function(t){return function(e){return t.AdvanceFrame(e)}}(this))},t.prototype.Run=function(t){return this.AdvanceFrame(0)},t}(),AssetManager=function(){function t(t){this.game=t,this.textures={},this.audio={},this.video={},this.textureAtlases={},this.files={}}return t.prototype.game=null,t.prototype.textures=null,t.prototype.audio=null,t.prototype.video=null,t.prototype.files=null,t.prototype.textureAtlases=null,t.prototype.GetTexture=function(t){return this.textures[t]},t.prototype.GetAudio=function(t){return this.audio[t]},t.prototype.GetVideo=function(t){return this.video[t]},t.prototype.GetTextureAtlas=function(t){return this.textureAtlases[t]},t.prototype.GetFile=function(t){return this.files[t]},t}(),LoadType=Util.Enum("Texture","Audio","Video","File","TextureAtlas"),LoadJob=function(){function t(t,e,i){this.loadType=t,this.id=e,this.path=i}return t}(),Load=function(){function t(t){this.game=t,this.InitEventDispatch(),this.files=this.game.Assets.files,this.textures=this.game.Assets.textures,this.audio=this.game.Assets.audio,this.video=this.game.Assets.video,this.textureAtlases=this.game.Assets.textureAtlases,this.loadJobs=[],this.itemsLeftToLoad=0,this.progress=0,this.loaded=!1,this.loadLog=""}return t.MixIn(EventDispatcher),t.prototype.Audio=function(t,e){return this.loadJobs.push(new LoadJob(LoadType.Audio,e,t))},t.prototype.Texture=function(t,e){return this.loadJobs.push(new LoadJob(LoadType.Texture,e,t))},t.prototype.TextureAtlas=function(t,e){return this.loadJobs.push(new LoadJob(LoadType.TextureAtlas,e,t))},t.prototype.Video=function(t,e){return this.loadJobs.push(new LoadJob(LoadType.Video,e,t))},t.prototype.File=function(t,e){return this.loadJobs.push(new LoadJob(LoadType.File,e,t))},t.prototype.Font=function(t,e){var i,n,o;return o=document.createElement("style"),n=document.createElement("p"),i="@font-face{\n    font-family: "+e+";\n    src: url("+t+");\n}",i=document.createTextNode(i),o.appendChild(i),n.innerHTML="TEST",n.style.fontFamily=e,document.head.appendChild(o),document.body.appendChild(n)},t.prototype.LoadItemFinished=function(){var t,e;if(this.itemsLeftToLoad-=1,this.progress=(this.totalLoad-this.itemsLeftToLoad)/this.totalLoad,this.game.Emit("LoadProgressed",new Event(this.game,{progress:this.progress})),this.itemsLeftToLoad<=0)return null!=(t=document.getElementsByClassName("font-loader")[0])&&t.remove(),e=((new Date).getTime()-this.startTime)/1e3,this.Emit("LoadFinished",new Event(this.game,{timeToLoad:e})),console.log("%c"+this.game.name+" loaded in "+e+"s","background-color:green;\ncolor:white;\npadding:2px;\npadding-right:5px;\npadding-left:5px")},t.prototype.Load=function(){var t,e,i,n,o,r;this.totalLoad=this.loadJobs.length,this.itemsLeftToLoad=this.totalLoad,this.startTime=(new Date).getTime();try{for(o=this.loadJobs,r=[],e=0,i=o.length;e<i;e++)switch(n=o[e],n.loadType){case LoadType.Texture:r.push(this.LoadTexture(n));break;case LoadType.Video:r.push(this.LoadVideo(n));break;case LoadType.Audio:r.push(this.LoadAudio(n));break;case LoadType.File:r.push(this.LoadFile(n));break;case LoadType.TextureAtlas:r.push(this.LoadTextureAtlas(n));break;default:r.push(void 0)}return r}catch(e){return t=e,console.log("%c"+this.game.name+" could not load!","background-color:"+Color.Ruby+";\ncolor:white;\npadding:2px;\npadding-right:5px;\npadding-left:5px"),Torch.FatalError(t)}},t.prototype.LoadTexture=function(t){var e;return e=new Image,e.src=t.path,this.textures[t.id]=e,e.onload=function(t){return function(){return t.LoadItemFinished()}}(this)},t.prototype.LoadTextureAtlas=function(t){var e;return e=new Torch.AjaxLoader(t.path,Torch.AjaxData.Text),e.loadJob=t,e.Finish(function(t){return function(e,i){return t.LoadItemFinished(),t.textureAtlases[i.loadJob.id]=JSON.parse(e)}}(this)),e.Load()},t.prototype.LoadVideo=function(t){var e;return e=document.createElement("video"),e.src=t.path,this.video[t.id]=e,e.addEventListener("loadeddata",function(t){return function(){return t.LoadItemFinished()}}(this))},t.prototype.LoadAudio=function(t){var e;return e=new Torch.AjaxLoader(t.path,Torch.AjaxData.ArrayBuffer),e.loadJob=t,e.Finish(function(t){return function(e,i){return t.audio[i.loadJob.id]={},t.audio[i.loadJob.id].encodedAudioData=e,t.game.Audio.DecodeAudioData(e,function(e){return t.audio[i.loadJob.id].audioData=e,t.LoadItemFinished()})}}(this)),e.Load()},t.prototype.LoadFile=function(t){var e;return e=new Torch.AjaxLoader(t.path,Torch.AjaxData.Text),e.loadJob=t,e.Finish(function(t){return function(e,i){return t.LoadItemFinished(),t.files[i.loadJob.id]=e}}(this)),e.Load()},t}(),Timer=function(){function t(t){this.game=t}return t.prototype.SetFutureEvent=function(t,e){var i;return i=new FutureEvent(t,e,this.game),this.game.Add(i),i},t.prototype.SetScheduledEvent=function(t,e){var i;return i=new ScheduledEvent(t,e,this.game),this.game.Add(i),i},t}(),FutureEvent=function(t){function e(t,e,i){this.timeToOccur=t,this.handle=e,this.game=i,this.time=0}return extend(e,t),e.prototype.Update=function(){if(this.time+=this.game.Loop.updateDelta,this.time>=this.timeToOccur&&null!==this.handle&&void 0!==this.handle)return this.handle(),this.handle=null},e}(GameThing),ScheduledEvent=function(t){function e(t,e,i){this.interval=t,this.handle=e,this.game=i,this.elapsedTime=0}return extend(e,t),e.prototype.Update=function(){if(this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.interval)return null!=this.handle&&this.handle(),this.elapsedTime=0},e}(GameThing),Mouse=function(){function t(t){this.game=t,this.x=0,this.y=0,this.down=!1}return t.prototype.SetMousePos=function(t,e){var i;return i=t.getBoundingClientRect(),this.x=e.clientX-i.left,this.y=e.clientY-i.top},t.prototype.GetRectangle=function(){return new Rectangle(this.x,this.y,5,5)},t.prototype.SetCursor=function(t){var e;return e=this.game.Assets.GetTexture(t),this.game.canvasNode.style.cursor="url("+e.src+"), auto"},t}(),Camera=function(){function t(t){this.game=t,this.position=new Point(0,0),this.Viewport=new Viewport(this)}return t.prototype.position=null,t.prototype._jerkFollow=null,t.prototype.JerkFollow=function(t,e,i){return null==e&&(e=5),null==i&&(i={maxLeft:-500,maxRight:2e3,maxTop:-500,maxBottom:2e3}),this._jerkFollow=new JerkFollow(this,t,e,i),this.game.Add(this._jerkFollow)},t}(),Viewport=function(){function t(t){this.camera=t,this.maxWidth=this.width=window.innerWidth,this.maxHeight=this.height=window.innerHeight,this.rectangle=new Rectangle(this.camera.position.x,this.camera.position.y,this.width,this.height)}return t.prototype.width=0,t.prototype.height=0,t.prototype.maxWidth=0,t.prototype.maxHeight=0,t.prototype.Update=function(){return this.rectangle.x=this.camera.position.x,this.rectangle.y=this.camera.position.y,this.rectangle.width=this.width,this.rectangle.height=this.height},t}(),JerkFollow=function(t){function e(t,e,i,n){var o;this.camera=t,this.sprite=e,this.config=n,o=this.camera.Viewport,this.game=this.camera.game,this.Inc=o.width/i,this.boundLeft=o.width/i,this.boundRight=o.width-this.boundLeft,this.boundTop=0}return extend(e,t),e.prototype.boundLeft=0,e.prototype.boundRight=0,e.prototype.boundTop=0,e.prototype.boundBottom=0,e.prototype.Inc=0,e.prototype.Update=function(){if(this.sprite.position.x>=this.boundRight){if(this.sprite.position.x>=this.config.maxRight)return void(this.sprite.position.x=this.boundRight);this.boundRight+=this.Inc,this.boundLeft+=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x-this.Inc})}if(this.sprite.position.x<=this.boundLeft){if(this.sprite.position.x<=this.config.maxLeft)return void(this.sprite.position.x=this.boundLeft);this.boundRight-=this.Inc,this.boundLeft-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.x+this.Inc})}if(this.sprite.position.y<=this.boundTop)return this.sprite.position.y<=this.config.maxTop?void(this.sprite.position.y=this.boundTop):(this.boundTop-=this.Inc,this.boundBottom-=this.Inc,this.game.Tweens.Tween(this.camera.position,500,Torch.Easing.Smooth).To({x:this.camera.position.y+this.Inc}))},e}(GameThing),Layer=function(){function t(t){this.drawIndex=t,this.children=[],this.mapIndex-this.drawIndex}return t.prototype.DrawIndex=function(t){var e,i,n,o;if(!t)return this.drawIndex;for(this.drawIndex=t,o=this.children,i=0,n=o.length;i<n;i++)e=o[i],e.DrawIndex(t);return this},t.prototype.Add=function(t){return t.DrawIndex(this.index),this.children.push(t)},t}(),Layers=function(){function t(t){this.game=t,this.layers=[],this.layerMap={}}return t.prototype.Add=function(t){var e,i,n,o,r;if(i=null,"string"==typeof t)return i=new Layer(this.layers.length),this.layerName[t]=i,this.layers.add(i);for(r=[],e=0,n=t.length;e<n;e++)o=t[e],i=new Layer(this.layers.length),this.layerMap[o]=i,r.push(this.layers.add(i));return r},t.prototype.Remove=function(t,e){var i,n,o,r,s,a,h,u,p;if(this.layerMap[t]){for(i=[],a=layerMap[t],a.Trash(),delete this.layerMap[t],u=this.layers,p=[],n=r=0,h=u.length;r<h;n=++r)o=u[n],s=i[n],n!==a.mapIndex?(i.push(s),e?p.push(s.DrawIndex(s.DrawIndex()-1)):p.push(void 0)):p.push(void 0);return p}return Torch.FatalError("Unable to remove layer '"+t+"'. Layer does not exist")},t.prototype.Get=function(t){return this.layerMap[t]?this.layerMap[t]:Torch.FatalError("Unable to get layer '"+t+"'. Layer does not exist")},t}(),Key=function(){function t(t){this.keyCode=t,this.InitEventDispatch()}return t.MixIn(EventDispatcher),t.prototype.down=!1,t}(),Keys=function(){function t(){this.specialKeys={8:"Delete",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"PauseBreak",20:"CapsLock",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"LeftArrow",38:"UpArrow",39:"RightArrow",40:"DownArrow",45:"Insert",46:"Delete2",48:"Num0",49:"Num1",50:"Num2",51:"Num3",52:"Num4",53:"Num5",54:"Num6",55:"Num7",56:"Num8",57:"Num9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",106:"NumPadMultiply",107:"NumPadPlus",109:"NumPadMinus",110:"NumPadPeriod",111:"NumPadDivide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",186:"Colon",187:"NumPlus",188:"Comma",189:"NumMinus",190:"Period",191:"ForwardSlash",192:"Tilda",219:"BracketLeft",221:"BracketRight",220:"BackSlash",222:"Quote"},this.InitKeys()}return t.MixIn(EventDispatcher),t.prototype.SpecialKey=function(t){var e,i,n;i=this.specialKeys;for(e in i)if(n=i[e],t.toString()===e.toString())return this[n];return null},t.prototype.InitKeys=function(){var t,e,i,n,o,r,s;for(e=this,i=0;i<230;)t=String.fromCharCode(i).toUpperCase(),e[t]=new Key(i),i++;o=this.specialKeys,r=[];for(n in o)s=o[n],r.push(e[s]=new Key(n));return r},t}(),Tween=function(t){function e(t,e,i,n,o){var r,s,a;this.game=t,this.objectToTween=e,this.tweenProperties=i,this.timeTweenShouldTake=n,this.easing=o,this.InitEventDispatch(),this.game.Tweens.tweens.push(this),this.game.Add(this),this.originalObjectValues={},s=this.tweenProperties;for(r in s)a=s[r],this.originalObjectValues[r]=this.objectToTween[r]}return extend(e,t),e.MixIn(EventDispatcher),e.prototype.objectToTween=null,e.prototype.tweenProperties=null,e.prototype.originalObjectValues=null,e.prototype.elapsedTime=0,e.prototype.timeTweenShouldTake=0,e.prototype.easing=null,e.prototype.repeat=!1,e.prototype.cycle=!1,e.prototype.Update=function(){var t,e,i,n,o,r;i=this.elapsedTime/this.timeTweenShouldTake,t=this.Ease(i),n=this.tweenProperties;for(e in n)r=n[e],this.objectToTween[e]=this.tweenProperties[e]*t+this.originalObjectValues[e]*(1-t);if(this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.timeTweenShouldTake)return this.Emit("Finish",new Torch.Event(this.game,{tween:this})),this.cycle?(this.elapsedTime=0,o=Object.create(this.originalObjectValues),this.originalObjectValues=Object.create(this.tweenProperties),this.tweenProperties=o):this.Trash()},e.prototype.Cycle=function(){return this.cycle=!0,this},e.prototype.Ease=function(t){switch(this.easing){case Torch.Easing.Linear:return t;case Torch.Easing.Square:return Math.pow(t,2);case Torch.Easing.Cube:return Math.pow(t,3);case Torch.Easing.InverseSquare:return 1-Math.pow(1-t,2);case Torch.Easing.InverseCube:return 1-Math.pow(1-t,3);case Torch.Easing.Smooth:return t*t*(3-2*t);case Torch.Easing.SmoothSquare:return Math.pow(t*t*(3-2*t),2);case Torch.Easing.SmoothCube:return Math.pow(t*t*(3-2*t),3);case Torch.Easing.Sine:return Math.sin(t*Math.PI/2);case Torch.Easing.InverseSine:return 1-Math.sin((1-t)*Math.PI/2)}},e}(GameThing),TweenSetup=function(){function t(t,e,i,n){this.game=t,this.object=e,this.timeTweenShouldTake=i,this.easing=n}return t.prototype.To=function(t){return new Tween(this.game,this.object,t,this.timeTweenShouldTake,this.easing)},t.prototype.From=function(t){var e,i;for(e in t)i=t[e],this.object[e]=i;return this},t}(),TweenManager=function(){function t(t){this.game=t,this.tweens=[]}return t.prototype.Tween=function(t,e,i){return null==i&&(i=Torch.Easing.Smooth),new TweenSetup(this.game,t,e,i)},t.prototype.All=function(t){var e,i,n,o,r;for(n=this.game.tweens,o=[],e=0,i=n.length;e<i;e++)r=n[e],o.push(t(r));return o},t}(),ParticleEmitter=function(t){function e(t,e,i,n,o,r,s){this.game=t,this.interval=n,this.loop=o,this.particle=r,this.config=s,this.InitSprite(this.game,e,i),this.elapsedTime=0,this.hasEmitted=!1}return extend(e,t),e.prototype.particle=null,e.prototype.auto=!0,e.prototype.Update=function(){if(e.__super__.Update.call(this),void 0!==this.interval){if(!this.hasEmitted)return this.UpdateParticleEmitter();if(this.loop)return this.UpdateParticleEmitter()}},e.prototype.Particle=function(t){return t=t},e.prototype.UpdateParticleEmitter=function(){if(this.auto)return this.elapsedTime+=this.game.Loop.updateDelta,this.elapsedTime>=this.interval?(this.EmitParticles(),this.hasEmitted=!0,this.elapsedTime=0):void 0},e.prototype.EmitParticles=function(t){var e;for(null==t&&(t=!1),e=0;e<this.config.spread;)e++,this.EmitParticle();if(t)return this.Trash()},e.prototype.EmitParticle=function(){var t,e,i,n,o,r,s;return e=Util.Math.RandomInRange(this.config.minAngle,this.config.maxAngle),o=Util.Math.RandomInRange(this.config.minScale,this.config.maxScale),t=Util.Math.RandomInRange(this.config.minAlphaDecay,this.config.maxAlphaDecay),n=Util.Math.RandomInRange(this.config.minRadius,this.config.maxRadius),r=this.position.x,s=this.position.y,i="string"!=typeof this.particle?new this.particle(this.game,r,s):this.game.Factory.Sprite(r,s,this.particle),i.Body.velocity.x=Math.cos(e)*Util.Math.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.velocity.y=Math.sin(e)*Util.Math.RandomInRange(this.config.minVelocity,this.config.maxVelocity),i.Body.omega=Util.Math.RandomInRange(this.config.minOmega,this.config.maxOmega),i.Size.Scale(o,o),i.drawIndex=1e3,this.game.Tweens.Tween(i,t,Torch.Easing.Smooth).To({opacity:0}).On("Finish",function(){return i.Trash()})},e}(Sprite),ParticleManager=function(){function t(t){this.game=t}return t.prototype.ParticleEmitter=function(t,e,i,n,o,r){return new ParticleEmitter(this.game,t,e,i,n,o,r)},t}(),Sound=function(){function t(t){this.soundId=t}return t.prototype.volume=1,t.prototype.pan=0,t}(),Audio=function(){function t(t){this.game=t,this.GetAudioContext()}return t.prototype.audioContext=null,t.prototype.MasterVolume=1,t.prototype.GetAudioContext=function(){var t;try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioContext=new AudioContext}catch(e){return t=e,console.warn("Unable to initialize audio...")}},t.prototype.DecodeAudioData=function(t,e){return this.audioContext.decodeAudioData(t,function(t){return e(t)})},t.prototype.CreateAudioPlayer=function(){return new AudioPlayer(this)},t}(),AudioPlayer=function(){function t(t){this.audioContext=t.audioContext,this.game=t.game}return t.prototype.volume=1,t.prototype.CreateGain=function(t){var e;return null==t&&(t=1),e=this.audioContext.createGain(),e.gain.value=t,e},t.prototype.Play=function(t){return this.game.FatalError("Cannot play sound. sound must be Torch.Sound")},t.prototype.PlaySound=function(t,e,i){var n,o,r,s,a,h;for(null==e&&(e=0),null==i&&(i=null),h=this.audioContext.createBufferSource(),h.buffer=this.game.Assets.audio[t].audioData,1!==this.game.Audio.MasterVolume&&(null===i?i=[this.CreateGain(this.game.Audio.MasterVolume)]:i.push(this.CreateGain(this.game.Audio.MasterVolume))),i=null===i?[this.CreateGain(this.volume)]:slice.call(i).concat([this.CreateGain(this.volume)]),s=null,o=r=0,a=i.length;r<a;o=++r)if(n=i[o],null===s?h.connect(n):s.connect(n),s=n,o===i.length-1)return n.connect(this.audioContext.destination),void h.start(e);return h.connect(this.audioContext.destination),h.start(e)},t}(),HookManager=function(){function t(t){this.game=t,this.positionTransform=new Point(0,0)}return t.prototype.positionTransform=null,t}(),GameThingFactory=function(){function t(t){this.game=t}return t.prototype.game=null,t.prototype.Sprite=function(t,e,i){var n;return n=new Sprite(this.game,t,e),null!=i&&n.Bind.Texture(i),n},t.prototype.Group=function(t,e){var i;return i=new SpriteGroup(this.game,t,e)},t.prototype.Text=function(t,e,i){var n;return null==i&&(i={}),n=new Text(this.game,t,e,i)},t.prototype.Thing=function(t,e){var i;return i=new GameThing,null!=t&&(i.Update=t),null!=e&&(i.Draw=e),this.game.Add(i),i},t.prototype.Button=function(t,e,i,n){var o,r;return r=this.Text(t,e,{text:i.text||"button",color:i.color||"white",font:i.font||"monospace",fontSize:i.fontSize||12}),o=this.Sprite(t,e,n.mainBackground),r.Grid.Center().CenterVertical(),o.Grid.Append(r),o.On("Trash",function(){return r.Trash()}),o.On("MouseDown",function(){return o.Bind.Texture(n.mouseDownBackground||n.mainBackground)}),o.On("MouseUp",function(){return o.Bind.Texture(n.mainBackground)}),o},t}(),GamePad=function(){function t(t,e){this.game=t,this.index=e,this.InitEventDispatch(),this.buttons={A:new GamePadButton(this,1),B:new GamePadButton(this,2),X:new GamePadButton(this,3),Y:new GamePadButton(this,4),LeftBumper:new GamePadButton(this,5),RightBumper:new GamePadButton(this,6),LeftTrigger:new GamePadButton(this,7),RightTrigger:new GamePadButton(this,8),Back:new GamePadButton(this,9),Start:new GamePadButton(this,10),LeftStick:new GamePadButton(this,11),RightStick:new GamePadButton(this,12),DPadUp:new GamePadButton(this,13),DPadDown:new GamePadButton(this,14),DPadLeft:new GamePadButton(this,15),DPadRight:new GamePadButton(this,16)},this.buttonMap=["A","B","X","Y","LeftBumper","RightBumper","LeftTrigger","RightTrigger","Back","Start","LeftStick","RightStick","DPadUp","DPadDown","DPadLeft","DPadRight"],this.sticks={LeftStick:new GamePadStick(this),RightStick:new GamePadStick(this)}}return t.MixIn(EventDispatcher),t.prototype.connected=!1,t.prototype.buttons=null,t.prototype.sticks=null,t.prototype.SetState=function(t){var e,i,n,o,r,s,a;for(this.connected=t.connected,a=t.buttons,n=o=0,r=a.length;o<r;n=++o)s=a[n],i=this.buttons[this.buttonMap[n]],null!=i&&i.SetState(s);return e=t.axes,this.sticks.LeftStick.SetState(e[0],e[1]),this.sticks.RightStick.SetState(e[2],e[3])},t}(),GamePadManager=function(){function t(t){this.game=t,this._pads=[new GamePad(this.game),new GamePad(this.game),new GamePad(this.game),new GamePad(this.game)]}return t.prototype._pads=null,t.prototype.Pad=function(t){return this._pads[t]},t.prototype.Update=function(){var t,e,i,n,o,r;for(n=navigator.getGamepads(),r=[],t=e=0,i=n.length;e<i;t=++e)o=n[t],null!=o?r.push(this._pads[t].SetState(o)):r.push(void 0);return r},t}(),GamePadButton=function(){function t(t,e){this.gamePad=t,this.buttonCode=e,this.InitEventDispatch(),this.game=this.gamePad.game}return t.MixIn(EventDispatcher),t.prototype._wasDown=!1,t.prototype.down=!1,t.prototype.SetState=function(t){return this._wasDown&&!t.pressed&&this.Emit("ButtonPressed",new Torch.Event(this.game,{button:this})),this.down=t.pressed,this._wasDown=this.down},t}(),GamePadStick=function(){function t(t){this.gamePad=t}return t.MixIn(EventDispatcher),t.prototype.horizontalAxis=0,t.prototype.verticalAxis=0,t.prototype.EPSILON=.1,t.prototype.SetState=function(t,e){return Math.abs(t)>this.EPSILON?this.horizontalAxis=t:this.horizontalAxis=0,Math.abs(e)>this.EPSILON?this.verticalAxis=e:this.verticalAxis=0},t}(),CanvasGame=function(){function t(t,e,i,n,o,r){this.canvasId=t,this.width=e,this.height=i,this.name=n,this.graphicsType=o,this.pixel=null!=r?r:0,this.InitGame()}return t.prototype.torch_type="Game",t.MixIn(EventDispatcher),t.prototype.InitGame=function(){return this.InitEventDispatch(),this.InitGraphics(),this.InitComponents(),this.Style()},t.prototype.InitComponents=function(){var t,e;return e="background-color:"+Color.Flame.GetHtmlString()+"; color:"+Color.Ruby.GetHtmlString()+"; font-weight: bold; padding:2px; padding-right:5px;padding-left:5px",t="WebGL",this.graphicsType===Torch.CANVAS&&(t="Canvas"),console.log("%c Torch v"+Torch.prototype.version+" |"+t+"| - "+this.name,e),this.Loop=new Loop(this),this.Assets=new AssetManager(this),this.Load=new Load(this),this.Mouse=new Mouse(this),this.Timer=new Timer(this),this.Camera=new Camera(this),this.Layers=new Layers(this),this.Keys=new Keys(this),this.Tweens=new TweenManager(this),this.Particles=new ParticleManager(this),this.Audio=new Audio(this),this.Hooks=new HookManager(this),this.Factory=new GameThingFactory(this),this.State=new StateMachine(this),this.GamePads=new GamePadManager(this),this.deltaTime=0,this.fps=0,this.averageFps=0,this.allFPS=0,this.ticks=0,this.zoom=1,this.uidCounter=0,this.paused=!1,this.boundary=null,this.time=null,this.LastTimeStamp=null,this.things=[],this.DrawStack=[],this.AddStack=[],this.thingMap={},this.filter={}},t.prototype.InitGraphics=function(){return this.canvasNode=document.createElement("CANVAS"),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,document.getElementById(this.canvasId).appendChild(this.canvasNode),this.canvas=this.canvasNode.getContext("2d"),this.Clear("#cc5200")},t.prototype.PixelScale=function(){return this.canvas.mozImageSmoothingEnabled=!1,this.canvas.imageSmoothingEnabled=!1,this},t.prototype.Start=function(t){var e;if(e={Load:function(){},Update:function(){},Draw:function(){},Init:function(){}},Util.Object(e).Extend(t),this.load=e.Load,this.update=e.Update,this.draw=e.Draw,this.init=e.Init,this.load(this),this.Load.Load(),this.Load.On("LoadFinished",function(t){return function(){return t.init(t),t.WireUpEvents(),t.Run()}}(this)),this.canvasNode.width=this.width,this.canvasNode.height=this.height,"string"==typeof this.width&&(this.canvasNode.width=document.body.clientWidth),"string"==typeof this.height)return this.canvasNode.height=document.body.clientHeight},t.prototype.Add=function(t){if(!t.torch_game_thing)throw new ER.ArgumentError;return this.uidCounter++,t.torch_uid="thing"+this.uidCounter,t.torch_add_order=this.uidCounter,this.AddStack.push(t)},t.prototype.GetById=function(t){return this.thingMap[t]},t.prototype.Run=function(t){return this.Loop.Run(0)},t.prototype.FatalError=function(t){var e,i;if(!this.fatal)throw this.fatal=!0,"string"==typeof t&&(t=new Error(t)),this.Clear("#000"),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302Cmargin-left:15%font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302Cfont-size:20pxfont-weight:bold'>Stack Trace:</code>\n<br>\n<code style='color:#C9302Cfont-size:20px'>"+i+"</code>\n<br>\n<code style='color:#C9302Cfont-size:18px'>Time: "+this.time+"</code>",
document.body.innerHTML=e,this.RunGame=function(){},this.Run=function(){},this.Emit("FatalError",new Torch.Event(this,{error:t})),t},t.prototype.UpdateThings=function(){var t,e,i,n,o;for(t=[],n=this.things,e=0,i=n.length;e<i;e++)o=n[e],o.trash?(o.trashed=!0,null!=o.Emit&&o.Emit("Trash",new Torch.Event(this))):o.paused||(o.Update(),t.push(o));return this.things=t,this.things=this.things.concat(this.AddStack),this.AddStack=[]},t.prototype.DrawThings=function(){var t,e,i,n,o;for(this.canvas.clearRect(0,0,this.Camera.Viewport.maxWidth,this.Camera.Viewport.maxHeight),this.things.sort(function(t,e){return t.drawIndex===e.drawIndex?t.torch_add_order-e.torch_add_order:t.drawIndex-e.drawIndex}),i=this.things,n=[],t=0,e=i.length;t<e;t++)o=i[t],o.trash?n.push(void 0):n.push(o.Draw());return n},t.prototype.Clear=function(t){return void 0===t&&this.FatalError("Cannot clear undefined color"),"object"==typeof t&&(t=t.hex),this.canvasNode.style.backgroundColor=t,this},t.prototype.SetBoundaries=function(t,e,i,n){return this.boundary=new Rectangle(t,e,i,n)},t.prototype.getCanvasEvents=function(){var t;return t=[["mousemove",function(t){return function(e){return t.Mouse.SetMousePos(t.canvasNode,e),t.Emit("MouseMove",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mousedown",function(t){return function(e){return t.Mouse.down=!0,t.Emit("MouseDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["mouseup",function(t){return function(e){return t.Mouse.down=!1,t.Emit("MouseUp",new Torch.Event(t,{nativeEvent:e}))}}(this)],["touchstart",function(t){return function(e){return t.Mouse.down=!0}}(this)],["touchend",function(t){return function(e){return t.Mouse.down=!1}}(this)],["click",function(t){return function(e){return e.preventDefault(),e.stopPropagation(),t.Emit("Click",new Torch.Event(t,{nativeEvent:e})),!1}}(this)]]},t.prototype.getBodyEvents=function(){var t;return t=[["keydown",function(t){return function(e){var i,n;return i=e.keyCode,n=t.Keys.SpecialKey(i),null===n&&(n=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),n.down=!0,n.Emit("KeyDown",new Torch.Event(t,{nativeEvent:e}))}}(this)],["keyup",function(t){return function(e){var i,n;return i=e.keyCode,n=t.Keys.SpecialKey(i),null===n&&(n=t.Keys[String.fromCharCode(e.keyCode).toUpperCase()]),n.down=!1,n.Emit("KeyUp",new Torch.Event(t,{nativeEvent:e}))}}(this)]]},t.prototype.WireUpEvents=function(){var t,e,i,n,o,r,s,a,h;for(s=this.getCanvasEvents(),e=0,i=s.length;e<i;e++)t=s[e],this.canvasNode.addEventListener(t[0],t[1],!1);for(a=this.getBodyEvents(),o=0,n=a.length;o<n;o++)t=a[o],document.body.addEventListener(t[0],t[1],!1);return h=function(t){return function(e){return t.Emit("Resize",new Torch.Event(t,{nativeEvent:e}))}}(this),window.addEventListener("resize",h,!1),r=navigator.getGamepads()},t.prototype.TogglePause=function(){return this.paused?this.paused=!1:this.paused=!0,this},t.prototype.Style=function(){var t,e;return t=document.body,t.style.backgroundColor="black",t.style.overflow="hidden",t.style.margin=0,e=document.getElementsByTagName("CANVAS")[0],e.style.cursor="pointer"},t}(),Game=CanvasGame,TorchModule(Game,"Game"),TorchModule(Texture=function(){function t(t){this.image=t,this.width=this.image.width,this.height=this.image.height,this.drawParams=new DrawParams(this.width,this.height)}return t.prototype.image=null,t.prototype.drawParams=null,t.prototype.width=0,t.prototype.height=0,t}()),DrawParams=function(){function t(t,e){this.clipWidth=t,this.clipHeight=e}return t.prototype.clipX=0,t.prototype.clipY=0,t.prototype.clipWidth=0,t.prototype.clipHeight=0,t}(),TorchModule(Video=function(){function t(t){this.video=t,this.width=this.video.videoWidth,this.height=this.video.videoHeight,this.drawParams=new DrawParams(this.width,this.height)}return t.prototype.video=null,t.prototype.drawParams=null,t.prototype.width=0,t.prototype.height=0,t.prototype.Play=function(){return this.video.play(),this},t.prototype.Stop=function(){return this.video.stop(),this},t.prototype.Loop=function(t){return null==t&&(t=!0),this.video.loop=t,this},t}()),TorchModule(StateMachine=function(){function t(t){this.obj=t,this.currentState=null,this.states={},this.game=this.obj.game}return t.prototype.State=function(t,e){return void 0===e?(void 0===this.states[t]&&Torch.FatalError("Unable to get state. State '"+t+"' has not been added to the state machine"),this.states[t]):(e.stateMachine=this,e.game=this.game,this.states[t]=e)},t.prototype.AddState=function(t,e){return this.states[t]=e,e.game=this.game,e.stateMachine=this},t.prototype.Switch=function(){var t,e,i,n;return e=arguments[0],t=2<=arguments.length?slice.call(arguments,1):[],this.currentState&&void 0!==this.currentState.End&&(i=this.currentState).End.apply(i,[this.obj].concat(slice.call(t))),void 0!==this.State(e).Start&&(n=this.State(e)).Start.apply(n,[this.obj].concat(slice.call(t))),this.currentState=this.State(e)},t.prototype.Update=function(){if(null!==this.currentState&&void 0!==this.currentState)return this.currentState.Execute(this.obj)},t}()),State=function(){function t(t,e,i){this.Execute=t,this.Start=e,this.End=i}return t}(),TorchModule(Color=function(){function t(t,e,i){this.Set(t,e,i)}return t.prototype.hex=null,t.prototype.r=null,t.prototype.g=null,t.prototype.b=null,t.prototype.Set=function(t,e,i){return"string"==typeof t?(this.hex=t,this.DecodeHex()):(this.r=t,this.g=e,this.b=i,this.EncodeHex())},t.prototype.DecodeHex=function(){var t;return t=Util.String(this.hex).Chunk(2),this.r=parseInt(t[0],16),this.g=parseInt(t[1],16),this.b=parseInt(t[2],16)},t.prototype.EncodeHex=function(){return this.hex="",this.hex+=this.r.toString(16),this.hex+=this.g.toString(16),this.hex+=this.b.toString(16)},t.prototype.GetHtmlString=function(){return"#"+this.hex},t.prototype.Invert=function(){return this.Set(Math.floor(Math.abs(255-this.r)),Math.floor(Math.abs(255-this.g)),Math.floor(Math.abs(255-this.b)))},t.Random=function(){return new t(Math.floor(Util.Math.RandomInRange(0,255)),Math.floor(Util.Math.RandomInRange(0,255)),Math.floor(Util.Math.RandomInRange(0,255)))},t}()),Color.Red=new Color(256,0,0,1),Color.Green=new Color(0,256,0,1),Color.Blue=new Color(0,0,256,1),Color.Flame=new Color("ff8000"),Color.Ruby=new Color("e60000"),TorchModule(Rectangle=function(){function t(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.z=0}return t.prototype.GetOffset=function(t){var e,i,n,o,r,s,a;return s=this.x+this.width/2-(t.x+t.width/2),a=this.y+this.height/2-(t.y+t.height/2),i=this.width/2+t.width/2,e=this.height/2+t.height/2,o=this.x+this.width-(t.x+t.width),r=this.y+this.height-(t.y+t.height),n={x:i-Math.abs(s),y:e-Math.abs(a),vx:s,vy:a,halfWidths:i,halfHeights:e,sharedXPlane:o,sharedYPlane:r}},t.prototype.Intersects=function(t){var e,i;return e=this,i=t,e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y&&e.GetOffset(i)},t.prototype.ShiftFrom=function(t,e,i){var n,o;return n=null,o=null,n=void 0===e?t.x:t.x+e,o=void 0===i?t.y:t.y+i,this.x=n,this.y=o},t}()),TorchModule(Vector=function(){function t(t,e){this.x=t,this.y=e,this.ResolveVectorProperties()}return t.prototype.x=null,t.prototype.y=null,t.prototype.angle=null,t.prototype.magnitude=null,t.prototype.ResolveVectorProperties=function(){return this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y),this.angle=Math.atan2(this.y,this.x)},t.prototype.Resolve=function(){return this.ResolveVectorProperties()},t.prototype.Clone=function(){return new t(this.x,this.y)},t.prototype.Set=function(t,e){return this.x=t,this.y=e,this.ResolveVectorProperties()},t.prototype.AddScalar=function(t){return this.x+=t,this.y+=t,this.ResolveVectorProperties()},t.prototype.MultiplyScalar=function(t){return this.x*=t,this.y*=t,this.ResolveVectorProperties()},t.prototype.DivideScalar=function(t){return this.x/=t,this.y/=t,this.ResolveVectorProperties()},t.prototype.SubtractVector=function(t){return this.x-=t.x,this.y-=t.y,this.ResolveVectorProperties()},t.prototype.AddVector=function(t){return this.x+=t.x,this.y+=t.y,this.ResolveVectorProperties()},t.prototype.Normalize=function(){return this.DivideScalar(this.magnitude)},t.prototype.DotProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.Reverse=function(){return this.MultiplyScalar(-1)},t.prototype.IsPerpendicular=function(t){return 0===this.DotProduct(t)},t.prototype.IsSameDirection=function(t){return this.DotProduct(t)>0},t}()),TorchModule(Point=function(){function t(t,e,i){this.x=t,this.y=e,this.z=null!=i?i:0}return t.prototype.Apply=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.Subtract=function(e){return new t(e.x-this.x,e.y-this.y)},t.prototype.Clone=function(){return new t(this.x,this.y)},t.GetCenterPoint=function(e){var i,n,o,r,s,a,h;for(o=0,r=0,a=Infinity,s=Infinity,i=0,n=e.length;i<n;i++)h=e[i],h.x>o&&(o=h.x),h.y>r&&(r=h.y),h.x<s&&(s=h.x),h.y<a&&(a=h.y);return new t(.5*(o-s),.5*(r-a))},t}()),exports=this,Event=function(){function t(t,e){var i,n,o;this.game=t,this.data=e,null!==this.game&&(this.time=this.game.time),n=this.data;for(i in n)o=n[i],this[i]=o}return t}(),Torch=function(){function t(){var e,i,n;for(this.GamePads=t.GamePads,this.AjaxData=t.AjaxData,this.Types=t.Types,this.Easing=t.Easing,this.Util=Util,e=0,i=TorchModules.length;e<i;e++)n=TorchModules[e],this[n.name]=n.mod}return t.prototype.CANVAS=1,t.prototype.WEBGL=2,t.prototype.PIXEL=3,t.prototype.DUMP_ERRORS=!1,t.GamePads=Util.Enum("Pad1","Pad2","Pad3","Pad4"),t.AjaxData=Util.Enum("DOMString","ArrayBuffer","Blob","Document","Json","Text"),t.Types=Util.Enum("String","Number","Object","Array","Function","Sprite","Game","Null"),t.Easing=Util.Enum("Linear","Square","Cube","InverseSquare","InverseCube","Smooth","SmoothSquare","SmoothCube","Sine","InverseSine"),t.AjaxLoader=AjaxLoader,t.Event=Event,t.Util=new Utilities,t.FatalError=function(t){var e,i;if(!this.fatal)return this.fatal=!0,"string"===Util.Type(t)?t=new Error(t):null==t.stack&&(t=t.nativeError),document.body.backgroundColor="black",this.DUMP_ERRORS&&void 0!==require&&require("fs").writeFileSync("torch-error.log",t.stack),i=t.stack.replace(/\n/g,"<br><br>"),e="<code style='color:#C9302C;margin-left:15%;font-size:24px'>"+t+"</code>\n<br>\n<code style='color:#C9302C;font-size:20px;font-weight:bold'>Stack Trace:</code><br>\n<code style='color:#C9302C;font-size:20px'>"+i+"</code><br>",document.body.innerHTML=e},t.prototype.StrictErrors=function(){return this.STRICT_ERRORS=!0},t.prototype.DumpErrors=function(){return this.DUMP_ERRORS=!0},t}(),exports.Torch=new Torch,Torch.prototype.version="0.9.162"}).call(this);